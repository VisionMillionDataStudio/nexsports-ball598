# ç¯®çƒè¿åŠ¨åœºæ™¯ç‰©ä½“æ£€æµ‹æ£€æµ‹ç³»ç»Ÿæºç åˆ†äº«
 # [ä¸€æ¡é¾™æ•™å­¦YOLOV8æ ‡æ³¨å¥½çš„æ•°æ®é›†ä¸€é”®è®­ç»ƒ_70+å…¨å¥—æ”¹è¿›åˆ›æ–°ç‚¹å‘åˆŠ_Webå‰ç«¯å±•ç¤º]

### 1.ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

é¡¹ç›®å‚è€ƒ[AAAI Association for the Advancement of Artificial Intelligence](https://gitee.com/qunmasj/projects)

é¡¹ç›®æ¥æº[AACV Association for the Advancement of Computer Vision](https://kdocs.cn/l/cszuIiCKVNis)

ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

éšç€äººå·¥æ™ºèƒ½æŠ€æœ¯çš„è¿…çŒ›å‘å±•ï¼Œè®¡ç®—æœºè§†è§‰åœ¨å„ä¸ªé¢†åŸŸçš„åº”ç”¨è¶Šæ¥è¶Šå¹¿æ³›ï¼Œå°¤å…¶æ˜¯åœ¨ä½“è‚²é¢†åŸŸã€‚ç¯®çƒä½œä¸ºå…¨çƒèŒƒå›´å†…å¹¿å—æ¬¢è¿çš„è¿åŠ¨ï¼Œå…¶æ¯”èµ›åœºæ™¯ä¸­æ¶‰åŠåˆ°çš„åŠ¨æ€ç‰©ä½“æ£€æµ‹é—®é¢˜å¼•èµ·äº†å­¦æœ¯ç•Œå’Œå·¥ä¸šç•Œçš„å¹¿æ³›å…³æ³¨ã€‚ä¼ ç»Ÿçš„ç¯®çƒæ¯”èµ›åˆ†æä¸»è¦ä¾èµ–äºäººå·¥è§‚å¯Ÿå’Œè®°å½•ï¼Œè¿™ä¸ä»…è€—æ—¶è€—åŠ›ï¼Œè€Œä¸”å®¹æ˜“å—åˆ°ä¸»è§‚å› ç´ çš„å½±å“ã€‚åŸºäºæ·±åº¦å­¦ä¹ çš„ç‰©ä½“æ£€æµ‹æŠ€æœ¯ï¼Œå°¤å…¶æ˜¯YOLOï¼ˆYou Only Look Onceï¼‰ç³»åˆ—æ¨¡å‹çš„æå‡ºï¼Œä¸ºå®æ—¶ã€å‡†ç¡®åœ°åˆ†æç¯®çƒæ¯”èµ›æä¾›äº†æ–°çš„å¯èƒ½æ€§ã€‚

YOLOv8ä½œä¸ºYOLOç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå…·å¤‡äº†æ›´é«˜çš„æ£€æµ‹ç²¾åº¦å’Œæ›´å¿«çš„å¤„ç†é€Ÿåº¦ï¼Œé€‚åˆäºå¤æ‚çš„è¿åŠ¨åœºæ™¯ã€‚é€šè¿‡æ”¹è¿›YOLOv8æ¨¡å‹ï¼Œèƒ½å¤Ÿæœ‰æ•ˆæå‡åœ¨ç¯®çƒè¿åŠ¨åœºæ™¯ä¸­å¯¹çƒå‘˜å’Œç¯®çƒçš„æ£€æµ‹èƒ½åŠ›ã€‚å…·ä½“è€Œè¨€ï¼Œæ”¹è¿›åçš„YOLOv8æ¨¡å‹å¯ä»¥åœ¨å¤æ‚çš„èƒŒæ™¯ã€å¿«é€Ÿçš„è¿åŠ¨çŠ¶æ€ä¸‹ï¼Œå®æ—¶è¯†åˆ«å’Œå®šä½ç¯®çƒåœºä¸Šçš„çƒå‘˜å’Œç¯®çƒï¼Œä»è€Œä¸ºæ¯”èµ›åˆ†æã€æˆ˜æœ¯ç ”ç©¶å’Œè¿åŠ¨å‘˜è®­ç»ƒæä¾›æ•°æ®æ”¯æŒã€‚

æœ¬ç ”ç©¶æ‰€ä½¿ç”¨çš„æ•°æ®é›†â€œnexsports-ballâ€åŒ…å«äº†10000å¼ ç¯®çƒè¿åŠ¨åœºæ™¯çš„å›¾åƒï¼Œæ¶µç›–äº†ä¸¤ä¸ªä¸»è¦ç±»åˆ«ï¼šç¯®çƒå’Œçƒå‘˜ã€‚è¿™ä¸€æ•°æ®é›†çš„æ„å»ºä¸ºè®­ç»ƒå’Œè¯„ä¼°æ”¹è¿›YOLOv8æ¨¡å‹æä¾›äº†ä¸°å¯Œçš„æ ·æœ¬åŸºç¡€ã€‚é€šè¿‡å¯¹è¯¥æ•°æ®é›†çš„æ·±å…¥åˆ†æï¼Œå¯ä»¥æå–å‡ºç¯®çƒè¿åŠ¨åœºæ™¯ä¸­çš„å…³é”®ç‰¹å¾ï¼Œè¿›è€Œä¼˜åŒ–æ¨¡å‹çš„å‚æ•°è®¾ç½®å’Œç»“æ„è®¾è®¡ï¼Œä»¥æé«˜æ£€æµ‹çš„å‡†ç¡®æ€§å’Œé²æ£’æ€§ã€‚

åœ¨ç¯®çƒè¿åŠ¨ä¸­ï¼Œçƒå‘˜çš„åŠ¨ä½œã€ä½ç½®ä»¥åŠç¯®çƒçš„è¿åŠ¨è½¨è¿¹éƒ½æ˜¯å½±å“æ¯”èµ›ç»“æœçš„é‡è¦å› ç´ ã€‚é€šè¿‡é«˜æ•ˆçš„ç‰©ä½“æ£€æµ‹ç³»ç»Ÿï¼Œå¯ä»¥å®ç°å¯¹æ¯”èµ›è¿‡ç¨‹çš„å®æ—¶ç›‘æ§ä¸åˆ†æï¼Œä¸ºæ•™ç»ƒå’Œè¿åŠ¨å‘˜æä¾›æ•°æ®é©±åŠ¨çš„å†³ç­–æ”¯æŒã€‚ä¾‹å¦‚ï¼Œæ•™ç»ƒå¯ä»¥åˆ©ç”¨æ£€æµ‹ç³»ç»Ÿåˆ†æçƒå‘˜çš„è·‘ä½æƒ…å†µã€æŠ•ç¯®å‘½ä¸­ç‡ç­‰æ•°æ®ï¼Œä»è€Œåˆ¶å®šæ›´ä¸ºç§‘å­¦çš„è®­ç»ƒè®¡åˆ’å’Œæˆ˜æœ¯å®‰æ’ã€‚æ­¤å¤–ï¼Œè§‚ä¼—ä¹Ÿå¯ä»¥é€šè¿‡è¯¥ç³»ç»Ÿè·å–æ¯”èµ›çš„å®æ—¶æ•°æ®åˆ†æï¼Œæå‡è§‚èµ›ä½“éªŒã€‚

ä»æ›´å¹¿æ³›çš„è§’åº¦æ¥çœ‹ï¼ŒåŸºäºæ”¹è¿›YOLOv8çš„ç¯®çƒè¿åŠ¨åœºæ™¯ç‰©ä½“æ£€æµ‹ç³»ç»Ÿçš„ç ”ç©¶ï¼Œä¸ä»…èƒ½å¤Ÿæ¨åŠ¨ç¯®çƒè¿åŠ¨çš„æ™ºèƒ½åŒ–å‘å±•ï¼Œè¿˜èƒ½å¤Ÿä¸ºå…¶ä»–è¿åŠ¨é¡¹ç›®çš„ç‰©ä½“æ£€æµ‹æä¾›å€Ÿé‰´ã€‚éšç€æ•°æ®é›†çš„ä¸æ–­ä¸°å¯Œå’Œæ¨¡å‹çš„ä¸æ–­ä¼˜åŒ–ï¼Œè¯¥ç³»ç»Ÿæœ‰æœ›åœ¨æœªæ¥å®ç°æ›´ä¸ºå¹¿æ³›çš„åº”ç”¨ï¼ŒåŒ…æ‹¬è¿åŠ¨å‘˜è¡¨ç°è¯„ä¼°ã€æ¯”èµ›ç­–ç•¥åˆ†æä»¥åŠæ™ºèƒ½è£åˆ¤ç³»ç»Ÿç­‰ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼ŒåŸºäºæ”¹è¿›YOLOv8çš„ç¯®çƒè¿åŠ¨åœºæ™¯ç‰©ä½“æ£€æµ‹ç³»ç»Ÿçš„ç ”ç©¶ï¼Œä¸ä»…å…·æœ‰é‡è¦çš„å­¦æœ¯ä»·å€¼ï¼Œè¿˜å…·å¤‡å¹¿æ³›çš„åº”ç”¨å‰æ™¯ã€‚é€šè¿‡å¯¹ç¯®çƒè¿åŠ¨åœºæ™¯çš„æ·±å…¥ç ”ç©¶ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ¨åŠ¨ä½“è‚²æ•°æ®åˆ†æçš„æ™ºèƒ½åŒ–è¿›ç¨‹ï¼Œä¸ºç¯®çƒè¿åŠ¨çš„ç§‘å­¦å‘å±•è´¡çŒ®åŠ›é‡ã€‚

### 2.å›¾ç‰‡æ¼”ç¤º

![1.png](1.png)

![2.png](2.png)

![3.png](3.png)

##### æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ2.å›¾ç‰‡æ¼”ç¤ºâ€å’Œâ€œ3.è§†é¢‘æ¼”ç¤ºâ€å±•ç¤ºçš„ç³»ç»Ÿå›¾ç‰‡æˆ–è€…è§†é¢‘å¯èƒ½ä¸ºè€ç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬åœ¨è€ç‰ˆæœ¬çš„åŸºç¡€ä¸Šå‡çº§å¦‚ä¸‹ï¼šï¼ˆå®é™…æ•ˆæœä»¥å‡çº§çš„æ–°ç‰ˆæœ¬ä¸ºå‡†ï¼‰

  ï¼ˆ1ï¼‰é€‚é…äº†YOLOV8çš„â€œç›®æ ‡æ£€æµ‹â€æ¨¡å‹å’Œâ€œå®ä¾‹åˆ†å‰²â€æ¨¡å‹ï¼Œé€šè¿‡åŠ è½½ç›¸åº”çš„æƒé‡ï¼ˆ.ptï¼‰æ–‡ä»¶å³å¯è‡ªé€‚åº”åŠ è½½æ¨¡å‹ã€‚

  ï¼ˆ2ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«æ¨¡å¼ã€‚

  ï¼ˆ3ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«ç»“æœä¿å­˜å¯¼å‡ºï¼Œè§£å†³æ‰‹åŠ¨å¯¼å‡ºï¼ˆå®¹æ˜“å¡é¡¿å‡ºç°çˆ†å†…å­˜ï¼‰å­˜åœ¨çš„é—®é¢˜ï¼Œè¯†åˆ«å®Œè‡ªåŠ¨ä¿å­˜ç»“æœå¹¶å¯¼å‡ºåˆ°tempDirä¸­ã€‚

  ï¼ˆ4ï¼‰æ”¯æŒWebå‰ç«¯ç³»ç»Ÿä¸­çš„æ ‡é¢˜ã€èƒŒæ™¯å›¾ç­‰è‡ªå®šä¹‰ä¿®æ”¹ï¼Œåé¢æä¾›ä¿®æ”¹æ•™ç¨‹ã€‚

  å¦å¤–æœ¬é¡¹ç›®æä¾›è®­ç»ƒçš„æ•°æ®é›†å’Œè®­ç»ƒæ•™ç¨‹,æš‚ä¸æä¾›æƒé‡æ–‡ä»¶ï¼ˆbest.ptï¼‰,éœ€è¦æ‚¨æŒ‰ç…§æ•™ç¨‹è¿›è¡Œè®­ç»ƒåå®ç°å›¾ç‰‡æ¼”ç¤ºå’ŒWebå‰ç«¯ç•Œé¢æ¼”ç¤ºçš„æ•ˆæœã€‚

### 3.è§†é¢‘æ¼”ç¤º

[3.1 è§†é¢‘æ¼”ç¤º](https://www.bilibili.com/video/BV1bQtCeNE3J/)

### 4.æ•°æ®é›†ä¿¡æ¯å±•ç¤º

##### 4.1 æœ¬é¡¹ç›®æ•°æ®é›†è¯¦ç»†æ•°æ®ï¼ˆç±»åˆ«æ•°ï¼†ç±»åˆ«åï¼‰

nc: 2
names: ['ball', 'player']


##### 4.2 æœ¬é¡¹ç›®æ•°æ®é›†ä¿¡æ¯ä»‹ç»

æ•°æ®é›†ä¿¡æ¯å±•ç¤º

åœ¨æœ¬ç ”ç©¶ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†åä¸ºâ€œnexsports-ballâ€çš„æ•°æ®é›†ï¼Œä»¥æ”¹è¿›YOLOv8åœ¨ç¯®çƒè¿åŠ¨åœºæ™¯ä¸­çš„ç‰©ä½“æ£€æµ‹èƒ½åŠ›ã€‚è¯¥æ•°æ®é›†ä¸“é—¨é’ˆå¯¹ç¯®çƒè¿åŠ¨çš„ç‰¹å®šéœ€æ±‚è€Œè®¾è®¡ï¼ŒåŒ…å«äº†ä¸°å¯Œçš„åœºæ™¯å’Œå¤šæ ·åŒ–çš„ç‰©ä½“ï¼Œä»¥ä¾¿äºæ¨¡å‹åœ¨å®é™…åº”ç”¨ä¸­èƒ½å¤Ÿæ›´å¥½åœ°è¯†åˆ«å’Œå®šä½ç¯®çƒåœºä¸Šçš„å…³é”®å…ƒç´ ã€‚æ•°æ®é›†çš„ç±»åˆ«æ•°é‡ä¸º2ï¼Œå…·ä½“åŒ…æ‹¬â€œballâ€ï¼ˆç¯®çƒï¼‰å’Œâ€œplayerâ€ï¼ˆçƒå‘˜ï¼‰ï¼Œè¿™ä¸¤ä¸ªç±»åˆ«æ˜¯ç¯®çƒæ¯”èµ›ä¸­æœ€ä¸ºé‡è¦çš„å…ƒç´ ã€‚

â€œnexsports-ballâ€æ•°æ®é›†çš„æ„å»ºè¿‡ç¨‹è€ƒè™‘åˆ°äº†ç¯®çƒæ¯”èµ›çš„å¤æ‚æ€§å’ŒåŠ¨æ€æ€§ã€‚æ•°æ®é›†ä¸­åŒ…å«äº†å¤šç§ä¸åŒçš„æ¯”èµ›åœºæ™¯ï¼ŒåŒ…æ‹¬ä¸åŒçš„åœºé¦†ã€ä¸åŒçš„æ—¶é—´æ®µä»¥åŠä¸åŒçš„æ¯”èµ›çŠ¶æ€ã€‚è¿™ç§å¤šæ ·æ€§ç¡®ä¿äº†æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­èƒ½å¤Ÿæ¥è§¦åˆ°ä¸°å¯Œçš„è§†è§‰ä¿¡æ¯ï¼Œä»è€Œæé«˜å…¶åœ¨å®é™…åº”ç”¨ä¸­çš„æ³›åŒ–èƒ½åŠ›ã€‚æ­¤å¤–ï¼Œæ•°æ®é›†ä¸­çš„å›¾åƒä¸ä»…åŒ…æ‹¬çƒå‘˜åœ¨åœºä¸Šçš„é™æ€å§¿åŠ¿ï¼Œè¿˜æ¶µç›–äº†ä»–ä»¬åœ¨æ¯”èµ›ä¸­å¿«é€Ÿç§»åŠ¨ã€æŠ•ç¯®ã€ä¼ çƒç­‰åŠ¨æ€è¡Œä¸ºçš„ç¬é—´ã€‚è¿™ç§åŠ¨æ€æ•°æ®çš„å¼•å…¥ä½¿å¾—æ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£å’Œé¢„æµ‹çƒå‘˜çš„è¡Œä¸ºï¼Œä»è€Œåœ¨ç‰©ä½“æ£€æµ‹ä»»åŠ¡ä¸­è¡¨ç°å¾—æ›´åŠ å‡ºè‰²ã€‚

ä¸ºäº†ç¡®ä¿æ•°æ®é›†çš„é«˜è´¨é‡å’Œå‡†ç¡®æ€§ï¼Œæ‰€æœ‰å›¾åƒå‡ç»è¿‡ç²¾å¿ƒæ ‡æ³¨ã€‚æ¯ä¸€å¼ å›¾åƒä¸­çš„ç¯®çƒå’Œçƒå‘˜éƒ½è¢«å‡†ç¡®åœ°æ¡†é€‰å‡ºæ¥ï¼Œå¹¶é™„ä¸Šç›¸åº”çš„æ ‡ç­¾ã€‚è¿™ç§ç²¾ç¡®çš„æ ‡æ³¨ä¸ä»…æé«˜äº†è®­ç»ƒæ•°æ®çš„å¯é æ€§ï¼Œä¹Ÿä¸ºåç»­çš„æ¨¡å‹è¯„ä¼°æä¾›äº†åšå®çš„åŸºç¡€ã€‚åœ¨æ•°æ®é›†çš„æ„å»ºè¿‡ç¨‹ä¸­ï¼Œç ”ç©¶å›¢é˜Ÿè¿˜ç‰¹åˆ«å…³æ³¨äº†ä¸åŒå…‰ç…§æ¡ä»¶ã€è§†è§’å’ŒèƒŒæ™¯å¯¹ç‰©ä½“æ£€æµ‹çš„å½±å“ï¼Œç¡®ä¿æ¨¡å‹èƒ½å¤Ÿåœ¨å„ç§ç¯å¢ƒä¸‹ä¿æŒè‰¯å¥½çš„æ€§èƒ½ã€‚

æ­¤å¤–ï¼Œæ•°æ®é›†çš„è§„æ¨¡ä¹Ÿç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œä»¥æ»¡è¶³YOLOv8æ¨¡å‹çš„è®­ç»ƒéœ€æ±‚ã€‚é€šè¿‡å¤§é‡çš„å›¾åƒæ ·æœ¬ï¼Œæ¨¡å‹èƒ½å¤Ÿå­¦ä¹ åˆ°ä¸°å¯Œçš„ç‰¹å¾è¡¨ç¤ºï¼Œä»è€Œåœ¨æ£€æµ‹ä»»åŠ¡ä¸­è¡¨ç°å‡ºæ›´é«˜çš„å‡†ç¡®æ€§å’Œé²æ£’æ€§ã€‚ç ”ç©¶å›¢é˜Ÿè¿˜è®¡åˆ’åœ¨æœªæ¥çš„å·¥ä½œä¸­ï¼Œè¿›ä¸€æ­¥æ‰©å±•æ•°æ®é›†çš„è§„æ¨¡å’Œå¤šæ ·æ€§ï¼ŒåŠ å…¥æ›´å¤šçš„åœºæ™¯å’Œç‰©ä½“ï¼Œä»¥æå‡æ¨¡å‹çš„æ€§èƒ½ã€‚

æ€»ä¹‹ï¼Œâ€œnexsports-ballâ€æ•°æ®é›†ä¸ºæ”¹è¿›YOLOv8åœ¨ç¯®çƒè¿åŠ¨åœºæ™¯ä¸­çš„ç‰©ä½“æ£€æµ‹æä¾›äº†åšå®çš„åŸºç¡€ã€‚é€šè¿‡ç²¾ç¡®çš„æ ‡æ³¨ã€å¤šæ ·åŒ–çš„åœºæ™¯å’Œä¸°å¯Œçš„åŠ¨æ€ä¿¡æ¯ï¼Œè¯¥æ•°æ®é›†ä¸ä»…å¢å¼ºäº†æ¨¡å‹çš„å­¦ä¹ èƒ½åŠ›ï¼Œä¹Ÿä¸ºåç»­çš„ç ”ç©¶å’Œåº”ç”¨å¥ å®šäº†è‰¯å¥½çš„åŸºç¡€ã€‚éšç€å¯¹è¯¥æ•°æ®é›†çš„æ·±å…¥ç ”ç©¶å’Œåº”ç”¨ï¼Œæˆ‘ä»¬æœŸå¾…èƒ½å¤Ÿåœ¨ç¯®çƒè¿åŠ¨çš„ç‰©ä½“æ£€æµ‹é¢†åŸŸå–å¾—æ›´ä¸ºæ˜¾è‘—çš„è¿›å±•ï¼Œä¸ºç›¸å…³æŠ€æœ¯çš„å‘å±•è´¡çŒ®åŠ›é‡ã€‚

![4.png](4.png)

![5.png](5.png)

![6.png](6.png)

![7.png](7.png)

![8.png](8.png)

### 5.å…¨å¥—é¡¹ç›®ç¯å¢ƒéƒ¨ç½²è§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰

[5.1 ç¯å¢ƒéƒ¨ç½²æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404473917358506534?logTag=c807d0cbc21c0ef59de5)




[5.2 å®‰è£…Pythonè™šæ‹Ÿç¯å¢ƒåˆ›å»ºå’Œä¾èµ–åº“å®‰è£…è§†é¢‘æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404474678003106304?logTag=1f1041108cd1f708b01a)

### 6.æ‰‹æŠŠæ‰‹YOLOV8è®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰

[6.1 æ‰‹æŠŠæ‰‹YOLOV8è®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰](https://www.ixigua.com/7404477157818401292?logTag=d31a2dfd1983c9668658)

### 7.70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰

[7.1 70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰](https://www.ixigua.com/7404478314661806627?logTag=29066f8288e3f4eea3a4)

### 8.70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹åŸç†è®²è§£ï¼ˆéç§‘ç­ä¹Ÿå¯ä»¥è½»æ¾å†™åˆŠå‘åˆŠï¼ŒV10ç‰ˆæœ¬æ­£åœ¨ç§‘ç ”å¾…æ›´æ–°ï¼‰

ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæ¯ä¸ªåˆ›æ–°ç‚¹çš„å…·ä½“åŸç†è®²è§£å°±ä¸ä¸€ä¸€å±•å¼€ï¼Œå…·ä½“è§ä¸‹åˆ—ç½‘å€ä¸­çš„åˆ›æ–°ç‚¹å¯¹åº”å­é¡¹ç›®çš„æŠ€æœ¯åŸç†åšå®¢ç½‘å€ã€Blogã€‘ï¼š

![9.png](9.png)

[8.1 70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹åŸç†è®²è§£é“¾æ¥](https://gitee.com/qunmasj/good)

### 9.ç³»ç»ŸåŠŸèƒ½å±•ç¤ºï¼ˆæ£€æµ‹å¯¹è±¡ä¸ºä¸¾ä¾‹ï¼Œå®é™…å†…å®¹ä»¥æœ¬é¡¹ç›®æ•°æ®é›†ä¸ºå‡†ï¼‰

å›¾9.1.ç³»ç»Ÿæ”¯æŒæ£€æµ‹ç»“æœè¡¨æ ¼æ˜¾ç¤º

  å›¾9.2.ç³»ç»Ÿæ”¯æŒç½®ä¿¡åº¦å’ŒIOUé˜ˆå€¼æ‰‹åŠ¨è°ƒèŠ‚

  å›¾9.3.ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰åŠ è½½æƒé‡æ–‡ä»¶best.pt(éœ€è¦ä½ é€šè¿‡æ­¥éª¤5ä¸­è®­ç»ƒè·å¾—)

  å›¾9.4.ç³»ç»Ÿæ”¯æŒæ‘„åƒå¤´å®æ—¶è¯†åˆ«

  å›¾9.5.ç³»ç»Ÿæ”¯æŒå›¾ç‰‡è¯†åˆ«

  å›¾9.6.ç³»ç»Ÿæ”¯æŒè§†é¢‘è¯†åˆ«

  å›¾9.7.ç³»ç»Ÿæ”¯æŒè¯†åˆ«ç»“æœæ–‡ä»¶è‡ªåŠ¨ä¿å­˜

  å›¾9.8.ç³»ç»Ÿæ”¯æŒExcelå¯¼å‡ºæ£€æµ‹ç»“æœæ•°æ®

![10.png](10.png)

![11.png](11.png)

![12.png](12.png)

![13.png](13.png)

![14.png](14.png)

![15.png](15.png)

![16.png](16.png)

![17.png](17.png)

### 10.åŸå§‹YOLOV8ç®—æ³•åŸç†

åŸå§‹YOLOv8ç®—æ³•åŸç†

YOLOv8ä½œä¸ºYOLOç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬ï¼Œæ‰¿è½½ç€æ·±åº¦å­¦ä¹ ç›®æ ‡æ£€æµ‹é¢†åŸŸçš„è¯¸å¤šåˆ›æ–°ä¸æ”¹è¿›ã€‚è‡ª2015å¹´YOLOæ¨¡å‹é¦–æ¬¡æå‡ºä»¥æ¥ï¼ŒYOLOç³»åˆ—ç»å†äº†å¤šä¸ªç‰ˆæœ¬çš„è¿­ä»£ï¼Œæ¯ä¸€æ¬¡æ›´æ–°éƒ½åœ¨è¿½æ±‚æ›´å¿«çš„æ¨ç†é€Ÿåº¦å’Œæ›´é«˜çš„æ£€æµ‹ç²¾åº¦ã€‚YOLOv8åœ¨æ­¤åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–äº†ç½‘ç»œç»“æ„ï¼Œä½¿å…¶åœ¨å®é™…åº”ç”¨ä¸­è¡¨ç°å‡ºè‰²ï¼Œæˆä¸ºå½“å‰ä¸šç•Œæœ€å—æ¬¢è¿çš„ç›®æ ‡æ£€æµ‹ç®—æ³•ä¹‹ä¸€ã€‚

YOLOv8çš„ç½‘ç»œç»“æ„ä¸»è¦ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šBackboneï¼ˆéª¨å¹²ç½‘ç»œï¼‰ã€Neckï¼ˆé¢ˆéƒ¨ç»“æ„ï¼‰å’ŒHeadï¼ˆå¤´éƒ¨ç»“æ„ï¼‰ã€‚å…¶ä¸­ï¼ŒBackboneè´Ÿè´£ç‰¹å¾æå–ï¼ŒNeckç”¨äºç‰¹å¾èåˆï¼Œè€ŒHeadåˆ™è´Ÿè´£æœ€ç»ˆçš„æ£€æµ‹è¾“å‡ºã€‚è¿™æ ·çš„è®¾è®¡ä½¿å¾—YOLOv8èƒ½å¤Ÿæœ‰æ•ˆåœ°å¤„ç†å¤æ‚çš„ç›®æ ‡æ£€æµ‹ä»»åŠ¡ï¼Œæä¾›å‡†ç¡®ä¸”é«˜æ•ˆçš„ç»“æœã€‚

åœ¨Backboneéƒ¨åˆ†ï¼ŒYOLOv8å€Ÿé‰´äº†YOLOv7ä¸­çš„ELANæ¨¡å—ï¼Œé‡‡ç”¨äº†C2Fæ¨¡å—æ›¿ä»£äº†YOLOv5ä¸­çš„C3æ¨¡å—ã€‚C2Fæ¨¡å—é€šè¿‡å¼•å…¥æ›´å¤šçš„å¹¶è¡Œæ¢¯åº¦æµåˆ†æ”¯ï¼Œå¢å¼ºäº†ç‰¹å¾æå–çš„èƒ½åŠ›ã€‚è¿™ç§è®¾è®¡ä¸ä»…æé«˜äº†æ¨¡å‹çš„ç²¾åº¦ï¼Œè¿˜æœ‰æ•ˆé™ä½äº†å»¶è¿Ÿï¼Œä½¿å¾—YOLOv8åœ¨å¤„ç†é«˜åˆ†è¾¨ç‡å›¾åƒæ—¶ä¾ç„¶èƒ½å¤Ÿä¿æŒè‰¯å¥½çš„æ€§èƒ½ã€‚C2Fæ¨¡å—çš„ç»“æ„è®¾è®¡æ—¨åœ¨é€šè¿‡è·¨å±‚è¿æ¥ï¼Œä¸°å¯Œæ¢¯åº¦æµçš„ä¿¡æ¯ï¼Œä»è€Œå½¢æˆæ›´å¼ºçš„ç‰¹å¾è¡¨ç¤ºèƒ½åŠ›ã€‚è¿™ç§æ”¹è¿›ä½¿å¾—YOLOv8åœ¨é¢å¯¹å¤šæ ·åŒ–çš„ç›®æ ‡æ—¶ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°æ•æ‰åˆ°ç›®æ ‡çš„ç‰¹å¾ã€‚

åœ¨Neckéƒ¨åˆ†ï¼ŒYOLOv8å¯¹ç‰¹å¾èåˆçš„æ–¹å¼è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå»é™¤äº†YOLOv5ä¸­ä¸¤æ¬¡ä¸Šé‡‡æ ·ä¹‹å‰çš„1x1å·ç§¯è¿æ¥å±‚ï¼Œç›´æ¥å¯¹Backboneä¸åŒé˜¶æ®µè¾“å‡ºçš„ç‰¹å¾è¿›è¡Œä¸Šé‡‡æ ·ã€‚è¿™ä¸€å˜åŒ–ä¸ä»…ç®€åŒ–äº†ç½‘ç»œç»“æ„ï¼Œè¿˜æå‡äº†ç‰¹å¾èåˆçš„æ•ˆç‡ï¼Œä½¿å¾—æ¨¡å‹åœ¨ä¸åŒå°ºåº¦çš„ç›®æ ‡æ£€æµ‹ä¸­è¡¨ç°å¾—æ›´åŠ å‡ºè‰²ã€‚é€šè¿‡è·¯å¾„èšåˆç½‘ç»œï¼ˆPANï¼‰çš„å¼•å…¥ï¼ŒYOLOv8èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†ä¸åŒå°ºåº¦çš„å¯¹è±¡ï¼Œå¢å¼ºäº†ç½‘ç»œå¯¹å¤šå°ºåº¦ç‰¹å¾çš„èåˆèƒ½åŠ›ã€‚

YOLOv8çš„Headéƒ¨åˆ†æ˜¯å…¶æœ€å¤§çš„åˆ›æ–°ä¹‹ä¸€ï¼Œä¸»è¦ä½“ç°åœ¨å°†è€¦åˆå¤´ï¼ˆCoupled-Headï¼‰è½¬å˜ä¸ºè§£è€¦å¤´ï¼ˆDecoupled-Headï¼‰ã€‚åœ¨YOLOv5ä¸­ï¼Œæ£€æµ‹å’Œåˆ†ç±»å…±ç”¨ä¸€ä¸ªå·ç§¯ï¼Œè€ŒYOLOv8åˆ™å°†è¿™ä¸¤ä¸ªä»»åŠ¡åˆ†å¼€å¤„ç†ã€‚è§£è€¦å¤´ç»“æ„ä½¿å¾—æ¨¡å‹åœ¨è¿›è¡Œç±»åˆ«é¢„æµ‹å’Œè¾¹ç•Œæ¡†å›å½’æ—¶èƒ½å¤Ÿæ›´åŠ ä¸“æ³¨ï¼Œä»è€Œæé«˜äº†æ•´ä½“çš„æ£€æµ‹ç²¾åº¦ã€‚åœ¨æŸå¤±å‡½æ•°çš„è®¾è®¡ä¸Šï¼ŒYOLOv8é‡‡ç”¨äº†BCELossï¼ˆBinary Cross Entropy Lossï¼‰ç”¨äºåˆ†ç±»åˆ†æ”¯ï¼Œè€Œè¾¹ç•Œæ¡†å›å½’åˆ†æ”¯åˆ™ç»“åˆäº†DFLï¼ˆDistribution Focal Lossï¼‰å’ŒCIoULossï¼ˆComplete Intersection over Union Lossï¼‰ï¼Œæ—¨åœ¨å¿«é€Ÿèšç„¦äºæ ‡ç­¾é™„è¿‘çš„æ•°å€¼ï¼Œæå‡æ¨¡å‹å¯¹è¾¹ç•Œæ¡†çš„é¢„æµ‹èƒ½åŠ›ã€‚

æ­¤å¤–ï¼ŒYOLOv8æ‘’å¼ƒäº†ä¼ ç»Ÿçš„Anchor-Basedï¼ˆåŸºäºé”šæ¡†ï¼‰æ–¹æ³•ï¼Œè½¬è€Œé‡‡ç”¨Anchor-Freeï¼ˆæ— é”šæ¡†ï¼‰ç­–ç•¥ã€‚è¿™ä¸€åˆ›æ–°ä½¿å¾—YOLOv8åœ¨ç›®æ ‡æ£€æµ‹æ—¶ä¸å†ä¾èµ–äºé¢„è®¾çš„é”šæ¡†ï¼Œä»è€Œå‡å°‘äº†è®¡ç®—å¤æ‚åº¦ï¼Œæé«˜äº†æ¨¡å‹çš„çµæ´»æ€§ã€‚é€šè¿‡å°†ç›®æ ‡æ£€æµ‹è½¬åŒ–ä¸ºå…³é”®ç‚¹æ£€æµ‹ï¼ŒYOLOv8èƒ½å¤Ÿåœ¨ä¸åŒçš„è®­ç»ƒæ•°æ®é›†ä¸Šå±•ç°å‡ºæ›´å¼ºçš„æ³›åŒ–èƒ½åŠ›ï¼Œç®€åŒ–äº†ç½‘ç»œæ¡†æ¶ã€‚

åœ¨è¾“å…¥ç«¯ï¼ŒYOLOv8é‡‡ç”¨äº†è‡ªé€‚åº”å›¾ç‰‡ç¼©æ”¾æŠ€æœ¯ï¼Œä»¥æé«˜ç›®æ ‡æ£€æµ‹å’Œæ¨ç†çš„é€Ÿåº¦ã€‚è¯¥æŠ€æœ¯é€šè¿‡å°†å›¾åƒçš„é•¿è¾¹æŒ‰æ¯”ä¾‹ç¼©å°åˆ°æŒ‡å®šå°ºå¯¸ï¼Œå¹¶å¯¹çŸ­è¾¹è¿›è¡Œå¡«å……ï¼Œå°½é‡å‡å°‘ä¿¡æ¯å†—ä½™ã€‚åŒæ—¶ï¼ŒYOLOv8åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¼•å…¥äº†Mosaicæ•°æ®å¢å¼ºæŠ€æœ¯ï¼Œé€šè¿‡éšæœºæ‹¼æ¥å¤šå¼ å›¾åƒï¼Œå¢å¼ºäº†æ¨¡å‹å¯¹ä¸åŒä½ç½®å’Œå‘¨å›´åƒç´ çš„å­¦ä¹ èƒ½åŠ›ã€‚è¿™ç§å¢å¼ºç­–ç•¥æœ‰æ•ˆæé«˜äº†æ¨¡å‹çš„é¢„æµ‹ç²¾åº¦å’Œæ€§èƒ½ã€‚

æ€»çš„æ¥è¯´ï¼ŒYOLOv8åœ¨å¤šä¸ªæ–¹é¢çš„æ”¹è¿›ä½¿å…¶åœ¨ç›®æ ‡æ£€æµ‹ä»»åŠ¡ä¸­å±•ç°å‡ºå“è¶Šçš„æ€§èƒ½ã€‚é€šè¿‡å¼•å…¥æ›´ä¸ºå…ˆè¿›çš„ç½‘ç»œç»“æ„ã€ä¼˜åŒ–ç‰¹å¾èåˆæ–¹å¼ã€è§£è€¦æ£€æµ‹ä¸åˆ†ç±»ä»»åŠ¡ï¼Œä»¥åŠé‡‡ç”¨æ— é”šæ¡†æ£€æµ‹ç­–ç•¥ï¼ŒYOLOv8ä¸ä»…æé«˜äº†æ£€æµ‹ç²¾åº¦å’Œé€Ÿåº¦ï¼Œè¿˜å¢å¼ºäº†æ¨¡å‹çš„çµæ´»æ€§å’Œé€‚åº”æ€§ã€‚è¿™äº›åˆ›æ–°ä½¿å¾—YOLOv8æˆä¸ºäº†ç›®æ ‡æ£€æµ‹é¢†åŸŸä¸­çš„ä¸€æ¬¾å¼ºå¤§å·¥å…·ï¼Œå¹¿æ³›åº”ç”¨äºå„ç§å®é™…åœºæ™¯ä¸­ï¼Œæ¨åŠ¨äº†æ·±åº¦å­¦ä¹ æŠ€æœ¯çš„è¿›ä¸€æ­¥å‘å±•ã€‚

![18.png](18.png)

### 11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰

#### 11.1 code\ultralytics\models\yolo\segment\val.py

ä»¥ä¸‹æ˜¯å¯¹ä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†è¿›è¡Œçš„åˆ†æå’Œè¯¦ç»†æ³¨é‡Šï¼š

```python
# å¯¼å…¥å¿…è¦çš„åº“
from multiprocessing.pool import ThreadPool
from pathlib import Path
import numpy as np
import torch
import torch.nn.functional as F
from ultralytics.models.yolo.detect import DetectionValidator
from ultralytics.utils import LOGGER, NUM_THREADS, ops
from ultralytics.utils.checks import check_requirements
from ultralytics.utils.metrics import SegmentMetrics, box_iou, mask_iou
from ultralytics.utils.plotting import output_to_target, plot_images

class SegmentationValidator(DetectionValidator):
    """
    ç»§æ‰¿è‡ªDetectionValidatorç±»ï¼Œç”¨äºåŸºäºåˆ†å‰²æ¨¡å‹çš„éªŒè¯ã€‚
    """

    def __init__(self, dataloader=None, save_dir=None, pbar=None, args=None, _callbacks=None):
        """åˆå§‹åŒ–SegmentationValidatorï¼Œè®¾ç½®ä»»åŠ¡ä¸º'segment'ï¼Œå¹¶åˆå§‹åŒ–æŒ‡æ ‡ä¸ºSegmentMetricsã€‚"""
        super().__init__(dataloader, save_dir, pbar, args, _callbacks)
        self.plot_masks = None  # ç”¨äºå­˜å‚¨ç»˜åˆ¶çš„æ©ç 
        self.process = None  # å¤„ç†æ©ç çš„å‡½æ•°
        self.args.task = "segment"  # è®¾ç½®ä»»åŠ¡ç±»å‹ä¸ºåˆ†å‰²
        self.metrics = SegmentMetrics(save_dir=self.save_dir, on_plot=self.on_plot)  # åˆå§‹åŒ–åˆ†å‰²æŒ‡æ ‡

    def preprocess(self, batch):
        """é¢„å¤„ç†æ‰¹æ¬¡ï¼Œå°†æ©ç è½¬æ¢ä¸ºæµ®ç‚¹æ•°å¹¶å‘é€åˆ°è®¾å¤‡ã€‚"""
        batch = super().preprocess(batch)  # è°ƒç”¨çˆ¶ç±»çš„é¢„å¤„ç†æ–¹æ³•
        batch["masks"] = batch["masks"].to(self.device).float()  # å°†æ©ç è½¬ç§»åˆ°è®¾å¤‡å¹¶è½¬æ¢ä¸ºæµ®ç‚¹æ•°
        return batch

    def init_metrics(self, model):
        """åˆå§‹åŒ–æŒ‡æ ‡å¹¶æ ¹æ®save_jsonæ ‡å¿—é€‰æ‹©æ©ç å¤„ç†å‡½æ•°ã€‚"""
        super().init_metrics(model)  # è°ƒç”¨çˆ¶ç±»çš„åˆå§‹åŒ–æŒ‡æ ‡æ–¹æ³•
        self.plot_masks = []  # åˆå§‹åŒ–ç»˜åˆ¶æ©ç çš„åˆ—è¡¨
        if self.args.save_json:
            check_requirements("pycocotools>=2.0.6")  # æ£€æŸ¥pycocotoolsåº“çš„è¦æ±‚
            self.process = ops.process_mask_upsample  # æ›´ç²¾ç¡®çš„æ©ç å¤„ç†
        else:
            self.process = ops.process_mask  # æ›´å¿«çš„æ©ç å¤„ç†
        self.stats = dict(tp_m=[], tp=[], conf=[], pred_cls=[], target_cls=[])  # åˆå§‹åŒ–ç»Ÿè®¡ä¿¡æ¯

    def postprocess(self, preds):
        """åå¤„ç†YOLOé¢„æµ‹ï¼Œè¿”å›è¾“å‡ºæ£€æµ‹å’ŒåŸå‹ã€‚"""
        p = ops.non_max_suppression(
            preds[0],
            self.args.conf,
            self.args.iou,
            labels=self.lb,
            multi_label=True,
            agnostic=self.args.single_cls,
            max_det=self.args.max_det,
            nc=self.nc,
        )  # åº”ç”¨éæå¤§å€¼æŠ‘åˆ¶
        proto = preds[1][-1] if len(preds[1]) == 3 else preds[1]  # è·å–åŸå‹
        return p, proto  # è¿”å›å¤„ç†åçš„é¢„æµ‹å’ŒåŸå‹

    def update_metrics(self, preds, batch):
        """æ›´æ–°æŒ‡æ ‡ã€‚"""
        for si, (pred, proto) in enumerate(zip(preds[0], preds[1])):
            self.seen += 1  # å¢åŠ å·²å¤„ç†çš„æ ·æœ¬æ•°
            npr = len(pred)  # å½“å‰é¢„æµ‹çš„æ•°é‡
            stat = dict(
                conf=torch.zeros(0, device=self.device),
                pred_cls=torch.zeros(0, device=self.device),
                tp=torch.zeros(npr, self.niou, dtype=torch.bool, device=self.device),
                tp_m=torch.zeros(npr, self.niou, dtype=torch.bool, device=self.device),
            )  # åˆå§‹åŒ–ç»Ÿè®¡ä¿¡æ¯
            pbatch = self._prepare_batch(si, batch)  # å‡†å¤‡æ‰¹æ¬¡
            cls, bbox = pbatch.pop("cls"), pbatch.pop("bbox")  # è·å–ç±»åˆ«å’Œè¾¹ç•Œæ¡†
            nl = len(cls)  # ç›®æ ‡æ•°é‡
            stat["target_cls"] = cls  # è®°å½•ç›®æ ‡ç±»åˆ«

            if npr == 0:  # å¦‚æœæ²¡æœ‰é¢„æµ‹
                if nl:
                    for k in self.stats.keys():
                        self.stats[k].append(stat[k])  # æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                continue  # è·³è¿‡å½“å‰å¾ªç¯

            # å¤„ç†æ©ç 
            gt_masks = pbatch.pop("masks")  # è·å–çœŸå®æ©ç 
            predn, pred_masks = self._prepare_pred(pred, pbatch, proto)  # å‡†å¤‡é¢„æµ‹ç»“æœå’Œæ©ç 
            stat["conf"] = predn[:, 4]  # ç½®ä¿¡åº¦
            stat["pred_cls"] = predn[:, 5]  # é¢„æµ‹ç±»åˆ«

            # è¯„ä¼°
            if nl:
                stat["tp"] = self._process_batch(predn, bbox, cls)  # å¤„ç†è¾¹ç•Œæ¡†
                stat["tp_m"] = self._process_batch(
                    predn, bbox, cls, pred_masks, gt_masks, self.args.overlap_mask, masks=True
                )  # å¤„ç†æ©ç 
                if self.args.plots:
                    self.confusion_matrix.process_batch(predn, bbox, cls)  # æ›´æ–°æ··æ·†çŸ©é˜µ

            for k in self.stats.keys():
                self.stats[k].append(stat[k])  # æ›´æ–°ç»Ÿè®¡ä¿¡æ¯

            pred_masks = torch.as_tensor(pred_masks, dtype=torch.uint8)  # è½¬æ¢é¢„æµ‹æ©ç ä¸ºå¼ é‡
            if self.args.plots and self.batch_i < 3:
                self.plot_masks.append(pred_masks[:15].cpu())  # è¿‡æ»¤å‰15ä¸ªæ©ç ä»¥ç»˜åˆ¶

            # ä¿å­˜ç»“æœ
            if self.args.save_json:
                pred_masks = ops.scale_image(
                    pred_masks.permute(1, 2, 0).contiguous().cpu().numpy(),
                    pbatch["ori_shape"],
                    ratio_pad=batch["ratio_pad"][si],
                )  # ç¼©æ”¾æ©ç 
                self.pred_to_json(predn, batch["im_file"][si], pred_masks)  # ä¿å­˜ä¸ºJSONæ ¼å¼

    def _process_batch(self, detections, gt_bboxes, gt_cls, pred_masks=None, gt_masks=None, overlap=False, masks=False):
        """
        è¿”å›æ­£ç¡®çš„é¢„æµ‹çŸ©é˜µã€‚
        Args:
            detections (array[N, 6]), x1, y1, x2, y2, conf, class
            labels (array[M, 5]), class, x1, y1, x2, y2
        Returns:
            correct (array[N, 10]), å¯¹äº10ä¸ªIoUçº§åˆ«
        """
        if masks:
            if overlap:
                nl = len(gt_cls)
                index = torch.arange(nl, device=gt_masks.device).view(nl, 1, 1) + 1
                gt_masks = gt_masks.repeat(nl, 1, 1)  # é‡å¤çœŸå®æ©ç 
                gt_masks = torch.where(gt_masks == index, 1.0, 0.0)  # å¤„ç†é‡å 
            if gt_masks.shape[1:] != pred_masks.shape[1:]:
                gt_masks = F.interpolate(gt_masks[None], pred_masks.shape[1:], mode="bilinear", align_corners=False)[0]
                gt_masks = gt_masks.gt_(0.5)  # äºŒå€¼åŒ–å¤„ç†
            iou = mask_iou(gt_masks.view(gt_masks.shape[0], -1), pred_masks.view(pred_masks.shape[0], -1))  # è®¡ç®—IoU
        else:  # å¤„ç†è¾¹ç•Œæ¡†
            iou = box_iou(gt_bboxes, detections[:, :4])  # è®¡ç®—è¾¹ç•Œæ¡†çš„IoU

        return self.match_predictions(detections[:, 5], gt_cls, iou)  # åŒ¹é…é¢„æµ‹å’ŒçœŸå®æ ‡ç­¾

    def plot_predictions(self, batch, preds, ni):
        """ç»˜åˆ¶æ‰¹æ¬¡é¢„æµ‹ç»“æœï¼ŒåŒ…æ‹¬æ©ç å’Œè¾¹ç•Œæ¡†ã€‚"""
        plot_images(
            batch["img"],
            *output_to_target(preds[0], max_det=15),  # ç»˜åˆ¶å‰15ä¸ªæ£€æµ‹ç»“æœ
            torch.cat(self.plot_masks, dim=0) if len(self.plot_masks) else self.plot_masks,
            paths=batch["im_file"],
            fname=self.save_dir / f"val_batch{ni}_pred.jpg",  # ä¿å­˜ç»˜åˆ¶ç»“æœ
            names=self.names,
            on_plot=self.on_plot,
        )
        self.plot_masks.clear()  # æ¸…ç©ºç»˜åˆ¶æ©ç åˆ—è¡¨
```

### ä»£ç åˆ†æ
1. **ç±» SegmentationValidator**: è¯¥ç±»ç”¨äºå¤„ç†åŸºäºåˆ†å‰²æ¨¡å‹çš„éªŒè¯ï¼Œç»§æ‰¿è‡ª`DetectionValidator`ï¼Œå¹¶é‡å†™äº†ä¸€äº›æ–¹æ³•ä»¥é€‚åº”åˆ†å‰²ä»»åŠ¡ã€‚
2. **åˆå§‹åŒ–æ–¹æ³•**: åœ¨åˆå§‹åŒ–ä¸­è®¾ç½®äº†ä»»åŠ¡ç±»å‹ã€æŒ‡æ ‡ç­‰ï¼Œå‡†å¤‡è¿›è¡Œåˆ†å‰²éªŒè¯ã€‚
3. **é¢„å¤„ç†å’Œåå¤„ç†**: åŒ…æ‹¬å¯¹è¾“å…¥æ‰¹æ¬¡çš„é¢„å¤„ç†ï¼ˆå¦‚å°†æ©ç è½¬æ¢ä¸ºæµ®ç‚¹æ•°ï¼‰å’Œå¯¹æ¨¡å‹è¾“å‡ºçš„åå¤„ç†ï¼ˆå¦‚åº”ç”¨éæå¤§å€¼æŠ‘åˆ¶ï¼‰ã€‚
4. **æŒ‡æ ‡æ›´æ–°**: åœ¨`update_metrics`æ–¹æ³•ä¸­ï¼Œæ›´æ–°å„ç§ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬çœŸå®æ ‡ç­¾å’Œé¢„æµ‹ç»“æœçš„æ¯”è¾ƒã€‚
5. **ç»˜å›¾åŠŸèƒ½**: æä¾›äº†ç»˜åˆ¶é¢„æµ‹ç»“æœå’ŒçœŸå®æ ‡ç­¾çš„åŠŸèƒ½ï¼Œä¾¿äºå¯è§†åŒ–éªŒè¯ç»“æœã€‚

ä»¥ä¸Šæ˜¯å¯¹ä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†çš„åˆ†æå’Œæ³¨é‡Šï¼Œæ¶µç›–äº†ç±»çš„ä¸»è¦åŠŸèƒ½å’Œå®ç°ç»†èŠ‚ã€‚

è¿™ä¸ªæ–‡ä»¶æ˜¯Ultralytics YOLOï¼ˆYou Only Look Onceï¼‰æ¨¡å‹ä¸­çš„ä¸€ä¸ªç”¨äºåˆ†å‰²ä»»åŠ¡çš„éªŒè¯å™¨ç±»ï¼Œåä¸º`SegmentationValidator`ã€‚å®ƒç»§æ‰¿è‡ª`DetectionValidator`ç±»ï¼Œä¸»è¦ç”¨äºå¤„ç†å›¾åƒåˆ†å‰²æ¨¡å‹çš„éªŒè¯è¿‡ç¨‹ã€‚è¯¥ç±»åŒ…å«å¤šä¸ªæ–¹æ³•ï¼Œç”¨äºæ•°æ®é¢„å¤„ç†ã€æŒ‡æ ‡åˆå§‹åŒ–ã€åå¤„ç†ã€æ‰¹å¤„ç†å‡†å¤‡ã€é¢„æµ‹å¤„ç†ã€æŒ‡æ ‡æ›´æ–°ã€ç»˜å›¾ç­‰åŠŸèƒ½ã€‚

åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œ`SegmentationValidator`è®¾ç½®äº†ä»»åŠ¡ç±»å‹ä¸ºâ€œsegmentâ€ï¼Œå¹¶åˆå§‹åŒ–äº†åˆ†å‰²æŒ‡æ ‡`SegmentMetrics`ã€‚è¯¥ç±»çš„ä¸»è¦åŠŸèƒ½æ˜¯å¤„ç†è¾“å…¥çš„æ‰¹æ¬¡æ•°æ®ï¼ŒåŒ…æ‹¬å°†æ©è†œè½¬æ¢ä¸ºæµ®ç‚¹æ•°å¹¶å‘é€åˆ°æŒ‡å®šè®¾å¤‡ï¼ˆå¦‚GPUï¼‰ã€‚åœ¨æŒ‡æ ‡åˆå§‹åŒ–ä¸­ï¼Œæ ¹æ®æ˜¯å¦éœ€è¦ä¿å­˜JSONæ ¼å¼çš„ç»“æœï¼Œé€‰æ‹©äº†ä¸åŒçš„æ©è†œå¤„ç†å‡½æ•°ã€‚

åœ¨`postprocess`æ–¹æ³•ä¸­ï¼Œæ¨¡å‹çš„é¢„æµ‹ç»“æœç»è¿‡éæå¤§å€¼æŠ‘åˆ¶ï¼ˆNMSï¼‰å¤„ç†ï¼Œä»¥å‡å°‘é‡å çš„æ£€æµ‹æ¡†ï¼Œå¹¶è¿”å›å¤„ç†åçš„æ£€æµ‹ç»“æœå’ŒåŸå‹æ•°æ®ã€‚`_prepare_batch`å’Œ`_prepare_pred`æ–¹æ³•ç”¨äºå‡†å¤‡è¾“å…¥æ•°æ®å’Œé¢„æµ‹ç»“æœï¼Œä»¥ä¾¿è¿›è¡Œåç»­çš„è¯„ä¼°å’Œè®¡ç®—ã€‚

`update_metrics`æ–¹æ³•æ˜¯è¯¥ç±»çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œè´Ÿè´£æ›´æ–°æ¨¡å‹çš„è¯„ä¼°æŒ‡æ ‡ã€‚å®ƒå¤„ç†æ¯ä¸ªæ‰¹æ¬¡çš„é¢„æµ‹ç»“æœï¼Œå¹¶ä¸çœŸå®æ ‡ç­¾è¿›è¡Œæ¯”è¾ƒï¼Œè®¡ç®—æ­£ç¡®é¢„æµ‹çš„æ•°é‡ã€ç½®ä¿¡åº¦ç­‰ä¿¡æ¯ã€‚è¯¥æ–¹æ³•è¿˜æ”¯æŒç»˜åˆ¶æ··æ·†çŸ©é˜µå’Œä¿å­˜é¢„æµ‹ç»“æœåˆ°JSONæ–‡ä»¶ã€‚

`finalize_metrics`æ–¹æ³•ç”¨äºåœ¨æ‰€æœ‰æ‰¹æ¬¡å¤„ç†å®Œæˆåï¼Œè®¾ç½®é€Ÿåº¦å’Œæ··æ·†çŸ©é˜µç­‰è¯„ä¼°æŒ‡æ ‡ã€‚`_process_batch`æ–¹æ³•åˆ™è´Ÿè´£æ ¹æ®IoUï¼ˆIntersection over Unionï¼‰è®¡ç®—æ­£ç¡®çš„é¢„æµ‹çŸ©é˜µï¼Œå¯ä»¥å¤„ç†æ¡†å’Œæ©è†œçš„è¯„ä¼°ã€‚

æ­¤å¤–ï¼Œ`plot_val_samples`å’Œ`plot_predictions`æ–¹æ³•ç”¨äºç»˜åˆ¶éªŒè¯æ ·æœ¬å’Œé¢„æµ‹ç»“æœï¼Œä¾¿äºå¯è§†åŒ–åˆ†æã€‚`pred_to_json`æ–¹æ³•å°†é¢„æµ‹ç»“æœä¿å­˜ä¸ºJSONæ ¼å¼ï¼Œæ–¹ä¾¿åç»­è¯„ä¼°ã€‚æœ€åï¼Œ`eval_json`æ–¹æ³•ç”¨äºè¯„ä¼°COCOæ ¼å¼çš„å¯¹è±¡æ£€æµ‹æŒ‡æ ‡ï¼Œè®¡ç®—mAPï¼ˆmean Average Precisionï¼‰ç­‰è¯„ä¼°æŒ‡æ ‡ã€‚

æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸ªæ–‡ä»¶çš„åŠŸèƒ½éå¸¸å…¨é¢ï¼Œæ¶µç›–äº†ä»æ•°æ®é¢„å¤„ç†åˆ°ç»“æœè¯„ä¼°çš„æ•´ä¸ªéªŒè¯è¿‡ç¨‹ï¼Œé€‚ç”¨äºYOLOæ¨¡å‹çš„å›¾åƒåˆ†å‰²ä»»åŠ¡ã€‚

#### 11.2 ui.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import sys
import subprocess

def run_script(script_path):
    """
    ä½¿ç”¨å½“å‰ Python ç¯å¢ƒè¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚

    Args:
        script_path (str): è¦è¿è¡Œçš„è„šæœ¬è·¯å¾„

    Returns:
        None
    """
    # è·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„
    python_path = sys.executable

    # æ„å»ºè¿è¡Œå‘½ä»¤ï¼Œä½¿ç”¨ streamlit è¿è¡ŒæŒ‡å®šçš„è„šæœ¬
    command = f'"{python_path}" -m streamlit run "{script_path}"'

    # æ‰§è¡Œå‘½ä»¤
    result = subprocess.run(command, shell=True)
    # æ£€æŸ¥å‘½ä»¤æ‰§è¡Œçš„è¿”å›ç ï¼Œå¦‚æœä¸ä¸º0ï¼Œè¡¨ç¤ºå‡ºé”™
    if result.returncode != 0:
        print("è„šæœ¬è¿è¡Œå‡ºé”™ã€‚")

# å®ä¾‹åŒ–å¹¶è¿è¡Œåº”ç”¨
if __name__ == "__main__":
    # æŒ‡å®šè¦è¿è¡Œçš„è„šæœ¬è·¯å¾„
    script_path = "web.py"  # è¿™é‡Œå¯ä»¥ç›´æ¥æŒ‡å®šè„šæœ¬è·¯å¾„

    # è°ƒç”¨å‡½æ•°è¿è¡Œè„šæœ¬
    run_script(script_path)
```

### ä»£ç æ³¨é‡Šè¯´æ˜ï¼š
1. **å¯¼å…¥æ¨¡å—**ï¼š
   - `sys`ï¼šç”¨äºè®¿é—®ä¸ Python è§£é‡Šå™¨ç´§å¯†ç›¸å…³çš„å˜é‡å’Œå‡½æ•°ã€‚
   - `subprocess`ï¼šç”¨äºåˆ›å»ºæ–°è¿›ç¨‹ã€è¿æ¥åˆ°å®ƒä»¬çš„è¾“å…¥/è¾“å‡º/é”™è¯¯ç®¡é“ï¼Œå¹¶è·å¾—è¿”å›ç ã€‚

2. **`run_script` å‡½æ•°**ï¼š
   - è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªè„šæœ¬è·¯å¾„ä½œä¸ºå‚æ•°ï¼Œå¹¶åœ¨å½“å‰ Python ç¯å¢ƒä¸­è¿è¡Œè¯¥è„šæœ¬ã€‚
   - ä½¿ç”¨ `sys.executable` è·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„ï¼Œä»¥ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ Python ç¯å¢ƒã€‚
   - æ„å»ºå‘½ä»¤å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ `streamlit` æ¨¡å—è¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚
   - ä½¿ç”¨ `subprocess.run` æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶é€šè¿‡ `shell=True` å…è®¸åœ¨ shell ä¸­æ‰§è¡Œå‘½ä»¤ã€‚
   - æ£€æŸ¥å‘½ä»¤çš„è¿”å›ç ï¼Œå¦‚æœè¿”å›ç ä¸ä¸º0ï¼Œè¡¨ç¤ºè„šæœ¬è¿è¡Œå‡ºé”™ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯ã€‚

3. **ä¸»ç¨‹åºéƒ¨åˆ†**ï¼š
   - åœ¨ `if __name__ == "__main__":` å—ä¸­ï¼ŒæŒ‡å®šè¦è¿è¡Œçš„è„šæœ¬è·¯å¾„ï¼ˆæ­¤å¤„ä¸º `web.py`ï¼‰ã€‚
   - è°ƒç”¨ `run_script` å‡½æ•°æ¥æ‰§è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶çš„ä¸»è¦åŠŸèƒ½æ˜¯é€šè¿‡å½“å‰çš„ Python ç¯å¢ƒæ¥è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„è„šæœ¬ï¼Œå…·ä½“æ¥è¯´æ˜¯ä¸€ä¸ªåä¸º `web.py` çš„è„šæœ¬ã€‚ç¨‹åºé¦–å…ˆå¯¼å…¥äº†å¿…è¦çš„æ¨¡å—ï¼ŒåŒ…æ‹¬ `sys`ã€`os` å’Œ `subprocess`ï¼Œè¿™äº›æ¨¡å—åˆ†åˆ«ç”¨äºç³»ç»Ÿç›¸å…³çš„æ“ä½œã€æ–‡ä»¶è·¯å¾„å¤„ç†å’Œæ‰§è¡Œå¤–éƒ¨å‘½ä»¤ã€‚

åœ¨ `run_script` å‡½æ•°ä¸­ï¼Œé¦–å…ˆè·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ Python ç¯å¢ƒæ¥è¿è¡Œè„šæœ¬ã€‚æ¥ç€ï¼Œæ„å»ºä¸€ä¸ªå‘½ä»¤å­—ç¬¦ä¸²ï¼Œè¯¥å‘½ä»¤ä½¿ç”¨ `streamlit` æ¨¡å—æ¥è¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚`streamlit` æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºæ•°æ®åº”ç”¨çš„æµè¡Œåº“ã€‚

ç„¶åï¼Œä½¿ç”¨ `subprocess.run` æ–¹æ³•æ‰§è¡Œæ„å»ºå¥½çš„å‘½ä»¤ã€‚è¿™ä¸ªæ–¹æ³•ä¼šåœ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹ä¸­è¿è¡Œå‘½ä»¤ï¼Œå¹¶ç­‰å¾…å…¶å®Œæˆã€‚å¦‚æœè„šæœ¬è¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¿”å›çš„ `returncode` å°†ä¸ä¸ºé›¶ï¼Œç¨‹åºä¼šæ‰“å°å‡ºâ€œè„šæœ¬è¿è¡Œå‡ºé”™â€çš„æç¤ºã€‚

åœ¨æ–‡ä»¶çš„æœ€åéƒ¨åˆ†ï¼Œä½¿ç”¨ `if __name__ == "__main__":` è¯­å¥æ¥ç¡®ä¿åªæœ‰åœ¨ç›´æ¥è¿è¡Œè¯¥æ–‡ä»¶æ—¶æ‰ä¼šæ‰§è¡Œåé¢çš„ä»£ç ã€‚è¿™é‡ŒæŒ‡å®šäº†è¦è¿è¡Œçš„è„šæœ¬è·¯å¾„ä¸º `web.py`ï¼Œå¹¶è°ƒç”¨ `run_script` å‡½æ•°æ¥æ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚

æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªç¨‹åºæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹å¼æ¥å¯åŠ¨ä¸€ä¸ªåŸºäº Streamlit çš„ Web åº”ç”¨ï¼Œç¡®ä¿ä½¿ç”¨å½“å‰çš„ Python ç¯å¢ƒæ¥æ‰§è¡Œã€‚

#### 11.3 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\utils\atss.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å¹¶æ·»åŠ è¯¦ç»†ä¸­æ–‡æ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼š

```python
import torch
import torch.nn as nn
import torch.nn.functional as F

def bbox_overlaps(bboxes1, bboxes2, mode='iou', is_aligned=False, eps=1e-6):
    """è®¡ç®—ä¸¤ä¸ªè¾¹ç•Œæ¡†é›†åˆä¹‹é—´çš„é‡å åº¦ã€‚

    å‚æ•°:
        bboxes1 (Tensor): å½¢çŠ¶ä¸º (M, 4) çš„è¾¹ç•Œæ¡†ï¼Œæ ¼å¼ä¸º <x1, y1, x2, y2>ã€‚
        bboxes2 (Tensor): å½¢çŠ¶ä¸º (N, 4) çš„è¾¹ç•Œæ¡†ï¼Œæ ¼å¼ä¸º <x1, y1, x2, y2>ã€‚
        mode (str): "iou"ï¼ˆäº¤å¹¶æ¯”ï¼‰ï¼Œ"iof"ï¼ˆå‰æ™¯äº¤é›†ï¼‰ï¼Œæˆ– "giou"ï¼ˆå¹¿ä¹‰äº¤å¹¶æ¯”ï¼‰ã€‚
        is_aligned (bool): å¦‚æœä¸º Trueï¼Œåˆ™ bboxes1 å’Œ bboxes2 çš„æ•°é‡å¿…é¡»ç›¸ç­‰ã€‚
        eps (float): ä¸ºäº†æ•°å€¼ç¨³å®šæ€§è€Œæ·»åŠ åˆ°åˆ†æ¯çš„å€¼ï¼Œé»˜è®¤å€¼ä¸º 1e-6ã€‚

    è¿”å›:
        Tensor: å½¢çŠ¶ä¸º (M, N) çš„é‡å åº¦çŸ©é˜µï¼Œå¦‚æœ is_aligned ä¸º Trueï¼Œåˆ™è¿”å›å½¢çŠ¶ä¸º (M,) çš„å‘é‡ã€‚
    """
    assert mode in ['iou', 'iof', 'giou'], f'ä¸æ”¯æŒçš„æ¨¡å¼ {mode}'
    assert (bboxes1.size(-1) == 4 or bboxes1.size(0) == 0)
    assert (bboxes2.size(-1) == 4 or bboxes2.size(0) == 0)

    # è·å–æ‰¹æ¬¡ç»´åº¦
    assert bboxes1.shape[:-2] == bboxes2.shape[:-2]
    batch_shape = bboxes1.shape[:-2]

    rows = bboxes1.size(-2)
    cols = bboxes2.size(-2)
    if is_aligned:
        assert rows == cols

    if rows * cols == 0:
        if is_aligned:
            return bboxes1.new(batch_shape + (rows, ))
        else:
            return bboxes1.new(batch_shape + (rows, cols))

    # è®¡ç®—æ¯ä¸ªè¾¹ç•Œæ¡†çš„é¢ç§¯
    area1 = (bboxes1[..., 2] - bboxes1[..., 0]) * (bboxes1[..., 3] - bboxes1[..., 1])
    area2 = (bboxes2[..., 2] - bboxes2[..., 0]) * (bboxes2[..., 3] - bboxes2[..., 1])

    if is_aligned:
        # è®¡ç®—é‡å åŒºåŸŸçš„å·¦ä¸Šè§’å’Œå³ä¸‹è§’åæ ‡
        lt = torch.max(bboxes1[..., :2], bboxes2[..., :2])  # [B, rows, 2]
        rb = torch.min(bboxes1[..., 2:], bboxes2[..., 2:])  # [B, rows, 2]

        wh = (rb - lt).clamp(min=0)  # è®¡ç®—é‡å åŒºåŸŸçš„å®½å’Œé«˜
        overlap = wh[..., 0] * wh[..., 1]  # è®¡ç®—é‡å é¢ç§¯

        if mode in ['iou', 'giou']:
            union = area1 + area2 - overlap  # è®¡ç®—å¹¶é›†
        else:
            union = area1
        if mode == 'giou':
            # è®¡ç®—åŒ…å›´æ¡†çš„å·¦ä¸Šè§’å’Œå³ä¸‹è§’åæ ‡
            enclosed_lt = torch.min(bboxes1[..., :2], bboxes2[..., :2])
            enclosed_rb = torch.max(bboxes1[..., 2:], bboxes2[..., 2:])
    else:
        # è®¡ç®—é‡å åŒºåŸŸçš„å·¦ä¸Šè§’å’Œå³ä¸‹è§’åæ ‡
        lt = torch.max(bboxes1[..., :, None, :2], bboxes2[..., None, :, :2])  # [B, rows, cols, 2]
        rb = torch.min(bboxes1[..., :, None, 2:], bboxes2[..., None, :, 2:])  # [B, rows, cols, 2]

        wh = (rb - lt).clamp(min=0)  # è®¡ç®—é‡å åŒºåŸŸçš„å®½å’Œé«˜
        overlap = wh[..., 0] * wh[..., 1]  # è®¡ç®—é‡å é¢ç§¯

        if mode in ['iou', 'giou']:
            union = area1[..., None] + area2[..., None, :] - overlap  # è®¡ç®—å¹¶é›†
        else:
            union = area1[..., None]
        if mode == 'giou':
            enclosed_lt = torch.min(bboxes1[..., :, None, :2], bboxes2[..., None, :, :2])
            enclosed_rb = torch.max(bboxes1[..., :, None, 2:], bboxes2[..., None, :, 2:])

    # è®¡ç®— IOU
    union = union.clamp(min=eps)  # é˜²æ­¢é™¤ä»¥é›¶
    ious = overlap / union  # è®¡ç®—é‡å åº¦

    if mode in ['iou', 'iof']:
        return ious  # è¿”å› IOU

    # è®¡ç®— GIOU
    enclose_wh = (enclosed_rb - enclosed_lt).clamp(min=0)
    enclose_area = enclose_wh[..., 0] * enclose_wh[..., 1]
    enclose_area = enclose_area.clamp(min=eps)
    gious = ious - (enclose_area - union) / enclose_area  # è®¡ç®— GIOU
    return gious

class ATSSAssigner(nn.Module):
    '''è‡ªé€‚åº”è®­ç»ƒæ ·æœ¬é€‰æ‹©åˆ†é…å™¨'''
    def __init__(self, topk=9, num_classes=80):
        super(ATSSAssigner, self).__init__()
        self.topk = topk  # æ¯ä¸ªç±»åˆ«é€‰æ‹©çš„å‰ k ä¸ªå€™é€‰æ¡†
        self.num_classes = num_classes  # ç±»åˆ«æ•°é‡
        self.bg_idx = num_classes  # èƒŒæ™¯ç±»åˆ«ç´¢å¼•

    @torch.no_grad()
    def forward(self, anc_bboxes, n_level_bboxes, gt_labels, gt_bboxes, mask_gt, pd_bboxes):
        """å‰å‘ä¼ æ’­å‡½æ•°ï¼Œè¿›è¡Œè¾¹ç•Œæ¡†åˆ†é…ã€‚

        å‚æ•°:
            anc_bboxes (Tensor): å½¢çŠ¶ä¸º (num_total_anchors, 4) çš„é”šæ¡†ã€‚
            n_level_bboxes (List): æ¯ä¸ªçº§åˆ«çš„è¾¹ç•Œæ¡†æ•°é‡ã€‚
            gt_labels (Tensor): å½¢çŠ¶ä¸º (bs, n_max_boxes, 1) çš„çœŸå®æ ‡ç­¾ã€‚
            gt_bboxes (Tensor): å½¢çŠ¶ä¸º (bs, n_max_boxes, 4) çš„çœŸå®è¾¹ç•Œæ¡†ã€‚
            mask_gt (Tensor): å½¢çŠ¶ä¸º (bs, n_max_boxes, 1) çš„çœŸå®æ¡†æ©ç ã€‚
            pd_bboxes (Tensor): å½¢çŠ¶ä¸º (bs, n_max_boxes, 4) çš„é¢„æµ‹è¾¹ç•Œæ¡†ã€‚

        è¿”å›:
            target_labels (Tensor): å½¢çŠ¶ä¸º (bs, num_total_anchors) çš„ç›®æ ‡æ ‡ç­¾ã€‚
            target_bboxes (Tensor): å½¢çŠ¶ä¸º (bs, num_total_anchors, 4) çš„ç›®æ ‡è¾¹ç•Œæ¡†ã€‚
            target_scores (Tensor): å½¢çŠ¶ä¸º (bs, num_total_anchors, num_classes) çš„ç›®æ ‡åˆ†æ•°ã€‚
            fg_mask (Tensor): å½¢çŠ¶ä¸º (bs, num_total_anchors) çš„å‰æ™¯æ©ç ã€‚
        """
        self.n_anchors = anc_bboxes.size(0)  # æ€»é”šæ¡†æ•°é‡
        self.bs = gt_bboxes.size(0)  # æ‰¹æ¬¡å¤§å°
        self.n_max_boxes = gt_bboxes.size(1)  # æœ€å¤§è¾¹ç•Œæ¡†æ•°é‡

        if self.n_max_boxes == 0:
            # å¦‚æœæ²¡æœ‰çœŸå®è¾¹ç•Œæ¡†ï¼Œè¿”å›èƒŒæ™¯æ ‡ç­¾å’Œé›¶å€¼
            device = gt_bboxes.device
            return torch.full([self.bs, self.n_anchors], self.bg_idx).to(device), \
                   torch.zeros([self.bs, self.n_anchors, 4]).to(device), \
                   torch.zeros([self.bs, self.n_anchors, self.num_classes]).to(device), \
                   torch.zeros([self.bs, self.n_anchors]).to(device)

        # è®¡ç®—çœŸå®æ¡†ä¸é”šæ¡†ä¹‹é—´çš„é‡å åº¦
        overlaps = bbox_overlaps(gt_bboxes.reshape([-1, 4]), anc_bboxes)
        overlaps = overlaps.reshape([self.bs, -1, self.n_anchors])

        # è®¡ç®—çœŸå®æ¡†ä¸é”šæ¡†ä¹‹é—´çš„è·ç¦»
        distances, ac_points = dist_calculator(gt_bboxes.reshape([-1, 4]), anc_bboxes)
        distances = distances.reshape([self.bs, -1, self.n_anchors])

        # é€‰æ‹© top-k å€™é€‰æ¡†
        is_in_candidate, candidate_idxs = self.select_topk_candidates(distances, n_level_bboxes, mask_gt)

        # è®¡ç®—é‡å åº¦é˜ˆå€¼
        overlaps_thr_per_gt, iou_candidates = self.thres_calculator(is_in_candidate, candidate_idxs, overlaps)

        # é€‰æ‹©é‡å åº¦å¤§äºé˜ˆå€¼çš„å€™é€‰æ¡†ä½œä¸ºæ­£æ ·æœ¬
        is_pos = torch.where(iou_candidates > overlaps_thr_per_gt.repeat([1, 1, self.n_anchors]),
                             is_in_candidate, torch.zeros_like(is_in_candidate))

        # é€‰æ‹©åœ¨çœŸå®æ¡†ä¸­çš„å€™é€‰æ¡†
        is_in_gts = select_candidates_in_gts(ac_points, gt_bboxes)
        mask_pos = is_pos * is_in_gts * mask_gt

        # é€‰æ‹©å…·æœ‰æœ€é«˜é‡å åº¦çš„ç›®æ ‡
        target_gt_idx, fg_mask, mask_pos = select_highest_overlaps(mask_pos, overlaps, self.n_max_boxes)

        # åˆ†é…ç›®æ ‡
        target_labels, target_bboxes, target_scores = self.get_targets(gt_labels, gt_bboxes, target_gt_idx, fg_mask)

        # ä½¿ç”¨ IOU è¿›è¡Œè½¯æ ‡ç­¾
        if pd_bboxes is not None:
            ious = iou_calculator(gt_bboxes, pd_bboxes) * mask_pos
            ious = ious.max(axis=-2)[0].unsqueeze(-1)
            target_scores *= ious

        return target_labels, target_bboxes, target_scores, fg_mask.bool(), target_gt_idx

    # å…¶ä»–è¾…åŠ©å‡½æ•°...
```

### ä»£ç è¯´æ˜ï¼š
1. **bbox_overlaps**: è®¡ç®—ä¸¤ä¸ªè¾¹ç•Œæ¡†é›†åˆä¹‹é—´çš„é‡å åº¦ï¼ˆIOUã€IOFæˆ–GIOUï¼‰ã€‚
2. **ATSSAssigner**: è‡ªé€‚åº”è®­ç»ƒæ ·æœ¬é€‰æ‹©åˆ†é…å™¨ï¼Œè´Ÿè´£å°†é”šæ¡†ä¸çœŸå®æ¡†è¿›è¡ŒåŒ¹é…ï¼Œç”Ÿæˆç›®æ ‡æ ‡ç­¾ã€è¾¹ç•Œæ¡†å’Œåˆ†æ•°ã€‚
3. **forward**: å‰å‘ä¼ æ’­å‡½æ•°ï¼Œå¤„ç†è¾“å…¥çš„é”šæ¡†ã€çœŸå®æ¡†ç­‰ï¼Œè¿”å›åŒ¹é…ç»“æœã€‚
4. **select_topk_candidates**ã€**thres_calculator**ã€**get_targets**: è¿™äº›æ˜¯è¾…åŠ©å‡½æ•°ï¼Œç”¨äºé€‰æ‹©å€™é€‰æ¡†ã€è®¡ç®—é˜ˆå€¼å’Œè·å–ç›®æ ‡ä¿¡æ¯ã€‚

ä»¥ä¸Šæ˜¯ä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†å’Œè¯¦ç»†æ³¨é‡Šï¼Œæ—¨åœ¨å¸®åŠ©ç†è§£æ¯ä¸ªå‡½æ•°çš„åŠŸèƒ½å’Œä½œç”¨ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ä¸»è¦å®ç°äº†YOLOv8ç®—æ³•ä¸­çš„ä¸€äº›å·¥å…·å‡½æ•°å’Œç±»ï¼Œä¸»è¦ç”¨äºç›®æ ‡æ£€æµ‹ä»»åŠ¡ä¸­çš„é”šæ¡†ç”Ÿæˆã€IoUè®¡ç®—ã€è·ç¦»è®¡ç®—ä»¥åŠè‡ªé€‚åº”è®­ç»ƒæ ·æœ¬é€‰æ‹©ç­‰åŠŸèƒ½ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ª`generate_anchors`å‡½æ•°ï¼Œè¯¥å‡½æ•°ç”¨äºæ ¹æ®ç‰¹å¾å›¾ç”Ÿæˆé”šæ¡†ã€‚å®ƒæ¥å—ç‰¹å¾å›¾ã€ç‰¹å¾å›¾çš„æ­¥å¹…ã€ç½‘æ ¼å•å…ƒå¤§å°å’Œåç§»é‡ç­‰å‚æ•°ã€‚åœ¨è¯„ä¼°æ¨¡å¼ä¸‹ï¼Œå‡½æ•°ç”Ÿæˆé”šç‚¹å¹¶è¿”å›é”šç‚¹å’Œæ­¥å¹…å¼ é‡ï¼›åœ¨è®­ç»ƒæ¨¡å¼ä¸‹ï¼Œå‡½æ•°åˆ™ç”Ÿæˆé”šæ¡†å¹¶è¿”å›é”šæ¡†ã€é”šç‚¹ã€é”šæ¡†æ•°é‡åˆ—è¡¨å’Œæ­¥å¹…å¼ é‡ã€‚

æ¥ä¸‹æ¥ï¼Œ`fp16_clamp`å‡½æ•°ç”¨äºå¯¹å¼ é‡è¿›è¡Œä¸Šä¸‹é™çº¦æŸï¼Œç‰¹åˆ«æ˜¯å¤„ç†æµ®ç‚¹16ï¼ˆFP16ï¼‰æ•°æ®ç±»å‹æ—¶ï¼Œç¡®ä¿æ•°å€¼ç¨³å®šæ€§ã€‚

`bbox_overlaps`å‡½æ•°ç”¨äºè®¡ç®—ä¸¤ä¸ªè¾¹ç•Œæ¡†é›†åˆä¹‹é—´çš„é‡å æƒ…å†µï¼Œæ”¯æŒå¤šç§é‡å è®¡ç®—æ¨¡å¼ï¼ˆå¦‚IoUã€IoFå’ŒGIoUï¼‰ã€‚è¯¥å‡½æ•°è€ƒè™‘äº†ä¸åŒçš„è¾“å…¥æƒ…å†µï¼Œå¹¶åœ¨è®¡ç®—è¿‡ç¨‹ä¸­ä½¿ç”¨äº†GPUåŠ é€Ÿä»¥æé«˜æ•ˆç‡ã€‚

`cast_tensor_type`å’Œ`iou2d_calculator`å‡½æ•°åˆ†åˆ«ç”¨äºè½¬æ¢å¼ é‡ç±»å‹å’Œè®¡ç®—2Dè¾¹ç•Œæ¡†ä¹‹é—´çš„é‡å æƒ…å†µï¼Œç¡®ä¿åœ¨ä¸åŒçš„æ•°æ®ç±»å‹ä¸‹è¿›è¡Œæœ‰æ•ˆçš„è®¡ç®—ã€‚

`dist_calculator`å‡½æ•°è®¡ç®—ç»™å®šè¾¹ç•Œæ¡†ä¸é”šæ¡†ä¹‹é—´çš„ä¸­å¿ƒè·ç¦»ï¼Œè¿”å›è·ç¦»å’Œé”šæ¡†çš„ä¸­å¿ƒç‚¹ã€‚

`iou_calculator`å‡½æ•°ç”¨äºæ‰¹é‡è®¡ç®—IoUï¼Œå¤„ç†ä¸åŒæ‰¹æ¬¡çš„è¾¹ç•Œæ¡†ã€‚

`ATSSAssigner`ç±»å®ç°äº†è‡ªé€‚åº”è®­ç»ƒæ ·æœ¬é€‰æ‹©çš„åŠŸèƒ½ã€‚è¯¥ç±»çš„`forward`æ–¹æ³•æ ¹æ®é”šæ¡†ã€ç‰¹å¾å›¾ä¸­çš„è¾¹ç•Œæ¡†ã€çœŸå®æ ‡ç­¾å’Œé¢„æµ‹è¾¹ç•Œæ¡†ç­‰ä¿¡æ¯ï¼Œè®¡ç®—å¹¶è¿”å›ç›®æ ‡æ ‡ç­¾ã€ç›®æ ‡è¾¹ç•Œæ¡†ã€ç›®æ ‡åˆ†æ•°å’Œå‰æ™¯æ©ç ã€‚ç±»ä¸­è¿˜åŒ…å«äº†é€‰æ‹©å€™é€‰æ¡†ã€é˜ˆå€¼è®¡ç®—å’Œç›®æ ‡è·å–ç­‰è¾…åŠ©æ–¹æ³•ï¼Œä»¥å®ç°é«˜æ•ˆçš„æ ·æœ¬é€‰æ‹©å’Œæ ‡ç­¾åˆ†é…ã€‚

æ€»ä½“è€Œè¨€ï¼Œè¿™ä¸ªæ–‡ä»¶æä¾›äº†YOLOv8ç®—æ³•ä¸­ç›®æ ‡æ£€æµ‹æ‰€éœ€çš„åŸºç¡€å·¥å…·ï¼Œæ”¯æŒé”šæ¡†ç”Ÿæˆã€é‡å è®¡ç®—å’Œæ ·æœ¬é€‰æ‹©ç­‰å…³é”®åŠŸèƒ½ï¼Œä¸ºåç»­çš„æ¨¡å‹è®­ç»ƒå’Œæ¨ç†æä¾›äº†é‡è¦æ”¯æŒã€‚

#### 11.4 code\ui_style.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å’Œæ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼š

```python
import base64
import streamlit as st

# è¯»å–äºŒè¿›åˆ¶æ–‡ä»¶å¹¶è½¬æ¢ä¸º Base64 ç¼–ç 
def get_base64_of_bin_file(bin_file):
    # ä»¥äºŒè¿›åˆ¶æ¨¡å¼æ‰“å¼€æ–‡ä»¶
    with open(bin_file, 'rb') as file:
        # è¯»å–æ–‡ä»¶å†…å®¹
        data = file.read()
    # å°†è¯»å–çš„äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œ Base64 ç¼–ç å¹¶è§£ç ä¸ºå­—ç¬¦ä¸²
    return base64.b64encode(data).decode()

# å®šä¹‰è‡ªå®šä¹‰ CSS æ ·å¼
def def_css_hitml():
    st.markdown("""
        <style>
        /* å…¨å±€æ ·å¼ */
        .css-2trqyj, .css-1d391kg, .st-bb, .st-at {
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; /* è®¾ç½®å­—ä½“ */
            background-color: #cadefc; /* è®¾ç½®èƒŒæ™¯é¢œè‰² */
            color: #21618C; /* è®¾ç½®å­—ä½“é¢œè‰² */
        }

        /* æŒ‰é’®æ ·å¼ */
        .stButton > button {
            border: none; /* å»æ‰è¾¹æ¡† */
            color: white; /* å­—ä½“é¢œè‰²ä¸ºç™½è‰² */
            padding: 10px 20px; /* è®¾ç½®å†…è¾¹è· */
            text-align: center; /* æ–‡æœ¬å±…ä¸­ */
            display: inline-block; /* ä½¿æŒ‰é’®ä¸ºå—çº§å…ƒç´  */
            font-size: 16px; /* è®¾ç½®å­—ä½“å¤§å° */
            margin: 2px 1px; /* è®¾ç½®å¤–è¾¹è· */
            cursor: pointer; /* é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºä¸ºæ‰‹å‹ */
            border-radius: 8px; /* è®¾ç½®åœ†è§’ */
            background-color: #9896f1; /* è®¾ç½®èƒŒæ™¯é¢œè‰² */
            box-shadow: 0 2px 4px 0 rgba(0,0,0,0.2); /* è®¾ç½®é˜´å½±æ•ˆæœ */
            transition-duration: 0.4s; /* è®¾ç½®è¿‡æ¸¡æ•ˆæœ */
        }
        .stButton > button:hover {
            background-color: #5499C7; /* æ‚¬åœæ—¶æ”¹å˜èƒŒæ™¯é¢œè‰² */
            color: white; /* æ‚¬åœæ—¶å­—ä½“é¢œè‰²ä¸ºç™½è‰² */
            box-shadow: 0 8px 12px 0 rgba(0,0,0,0.24); /* æ‚¬åœæ—¶æ”¹å˜é˜´å½±æ•ˆæœ */
        }

        /* ä¾§è¾¹æ æ ·å¼ */
        .css-1lcbmhc.e1fqkh3o0 {
            background-color: #154360; /* è®¾ç½®ä¾§è¾¹æ èƒŒæ™¯é¢œè‰² */
            color: #FDFEFE; /* è®¾ç½®ä¾§è¾¹æ å­—ä½“é¢œè‰² */
            border-right: 2px solid #DDD; /* è®¾ç½®å³è¾¹æ¡† */
        }

        /* è¡¨æ ¼æ ·å¼ */
        table {
            border-collapse: collapse; /* åˆå¹¶è¾¹æ¡† */
            margin: 25px 0; /* è®¾ç½®å¤–è¾¹è· */
            font-size: 18px; /* è®¾ç½®å­—ä½“å¤§å° */
            font-family: sans-serif; /* è®¾ç½®å­—ä½“ */
            min-width: 400px; /* è®¾ç½®æœ€å°å®½åº¦ */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); /* è®¾ç½®é˜´å½±æ•ˆæœ */
        }
        thead tr {
            background-color: #a8d8ea; /* è®¾ç½®è¡¨å¤´èƒŒæ™¯é¢œè‰² */
            color: #ffcef3; /* è®¾ç½®è¡¨å¤´å­—ä½“é¢œè‰² */
            text-align: left; /* è®¾ç½®æ–‡æœ¬å·¦å¯¹é½ */
        }
        th, td {
            padding: 15px 18px; /* è®¾ç½®å•å…ƒæ ¼å†…è¾¹è· */
        }
        tbody tr {
            border-bottom: 2px solid #ddd; /* è®¾ç½®è¡Œåº•éƒ¨è¾¹æ¡† */
        }
        tbody tr:nth-of-type(even) {
            background-color: #D6EAF8; /* è®¾ç½®å¶æ•°è¡ŒèƒŒæ™¯é¢œè‰² */
        }
        tbody tr:last-of-type {
            border-bottom: 3px solid #5499C7; /* è®¾ç½®æœ€åä¸€è¡Œåº•éƒ¨è¾¹æ¡† */
        }
        tbody tr:hover {
            background-color: #AED6F1; /* æ‚¬åœæ—¶æ”¹å˜è¡ŒèƒŒæ™¯é¢œè‰² */
        }
        </style>
        """, unsafe_allow_html=True)  # å…è®¸ä½¿ç”¨ HTML
```

### ä»£ç è¯´æ˜ï¼š
1. **å¯¼å…¥æ¨¡å—**ï¼šå¯¼å…¥ `base64` ç”¨äºç¼–ç å’Œè§£ç äºŒè¿›åˆ¶æ•°æ®ï¼Œå¯¼å…¥ `streamlit` ç”¨äºæ„å»ºç½‘é¡µåº”ç”¨ã€‚
2. **get_base64_of_bin_file å‡½æ•°**ï¼šè¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„ï¼Œè¯»å–æ–‡ä»¶å†…å®¹å¹¶å°†å…¶è½¬æ¢ä¸º Base64 ç¼–ç çš„å­—ç¬¦ä¸²ã€‚
3. **def_css_hitml å‡½æ•°**ï¼šè¯¥å‡½æ•°å®šä¹‰äº†ä¸€ç³»åˆ— CSS æ ·å¼ï¼Œç”¨äºç¾åŒ– Streamlit åº”ç”¨çš„ç•Œé¢ï¼ŒåŒ…æ‹¬å…¨å±€æ ·å¼ã€æŒ‰é’®æ ·å¼ã€ä¾§è¾¹æ æ ·å¼å’Œè¡¨æ ¼æ ·å¼ã€‚é€šè¿‡ `st.markdown` æ–¹æ³•å°†è¿™äº›æ ·å¼åº”ç”¨åˆ° Streamlit åº”ç”¨ä¸­ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ `ui_style.py` æ˜¯ä¸€ä¸ªç”¨äº Streamlit åº”ç”¨çš„æ ·å¼å®šä¹‰æ–‡ä»¶ï¼Œä¸»è¦ç›®çš„æ˜¯é€šè¿‡è‡ªå®šä¹‰ CSS æ¥ç¾åŒ–åº”ç”¨çš„ç”¨æˆ·ç•Œé¢ã€‚æ–‡ä»¶ä¸­åŒ…å«äº†å‡ ä¸ªä¸»è¦éƒ¨åˆ†ã€‚

é¦–å…ˆï¼Œç¨‹åºå¯¼å…¥äº† `base64` å’Œ `streamlit` åº“ã€‚`base64` ç”¨äºå¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶çš„ç¼–ç ï¼Œè€Œ `streamlit` æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºæ•°æ®åº”ç”¨çš„ Python åº“ã€‚

æ¥ä¸‹æ¥ï¼Œå®šä¹‰äº†ä¸€ä¸ªå‡½æ•° `get_base64_of_bin_file(bin_file)`ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶çš„è·¯å¾„ä½œä¸ºå‚æ•°ï¼Œæ‰“å¼€æ–‡ä»¶å¹¶è¯»å–å…¶å†…å®¹ï¼Œç„¶åå°†å…¶è½¬æ¢ä¸º Base64 ç¼–ç çš„å­—ç¬¦ä¸²ã€‚è¿™ç§ç¼–ç æ–¹å¼å¸¸ç”¨äºåœ¨ç½‘é¡µä¸­åµŒå…¥å›¾åƒæˆ–å…¶ä»–äºŒè¿›åˆ¶æ•°æ®ã€‚

ç„¶åï¼Œå®šä¹‰äº† `def_css_hitml()` å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°é€šè¿‡ `st.markdown` æ–¹æ³•å°†ä¸€æ®µ CSS æ ·å¼æ’å…¥åˆ° Streamlit åº”ç”¨ä¸­ã€‚CSS æ ·å¼åŒ…æ‹¬äº†å…¨å±€æ ·å¼ã€æŒ‰é’®æ ·å¼ã€ä¾§è¾¹æ æ ·å¼ã€å•é€‰æŒ‰é’®æ ·å¼ã€æ»‘å—æ ·å¼ä»¥åŠè¡¨æ ¼æ ·å¼ç­‰ã€‚

åœ¨å…¨å±€æ ·å¼éƒ¨åˆ†ï¼Œè®¾ç½®äº†å­—ä½“ã€èƒŒæ™¯é¢œè‰²å’Œæ–‡å­—é¢œè‰²ã€‚æŒ‰é’®æ ·å¼åˆ™å®šä¹‰äº†æŒ‰é’®çš„å¤–è§‚ï¼ŒåŒ…æ‹¬è¾¹æ¡†ã€é¢œè‰²ã€å†…è¾¹è·ã€å­—ä½“å¤§å°ã€è¾¹è·ã€åœ†è§’å’ŒèƒŒæ™¯è‰²ç­‰ï¼Œå¹¶ä¸”è¿˜ä¸ºæŒ‰é’®çš„æ‚¬åœçŠ¶æ€å®šä¹‰äº†ä¸åŒçš„èƒŒæ™¯è‰²å’Œé˜´å½±æ•ˆæœã€‚

ä¾§è¾¹æ çš„æ ·å¼è®¾ç½®äº†èƒŒæ™¯è‰²ã€æ–‡å­—é¢œè‰²å’Œè¾¹æ¡†æ ·å¼ï¼Œä½¿å…¶ä¸ä¸»å†…å®¹åŒºåŒºåˆ†å¼€æ¥ã€‚å•é€‰æŒ‰é’®å’Œæ»‘å—çš„æ ·å¼ä¹Ÿè¿›è¡Œäº†è‡ªå®šä¹‰ï¼Œä½¿å…¶æ›´ç¬¦åˆæ•´ä½“è®¾è®¡é£æ ¼ã€‚

æœ€åï¼Œè¡¨æ ¼çš„æ ·å¼éƒ¨åˆ†å®šä¹‰äº†è¡¨æ ¼çš„è¾¹æ¡†ã€é—´è·ã€å­—ä½“ã€é˜´å½±æ•ˆæœä»¥åŠè¡Œçš„èƒŒæ™¯è‰²å’Œæ‚¬åœæ•ˆæœï¼Œç¡®ä¿è¡¨æ ¼åœ¨è§†è§‰ä¸Šæ›´åŠ ç¾è§‚å’Œæ˜“äºé˜…è¯»ã€‚

æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸ªæ–‡ä»¶é€šè¿‡ CSS æ ·å¼çš„è‡ªå®šä¹‰ï¼Œæ—¨åœ¨æå‡ Streamlit åº”ç”¨çš„ç”¨æˆ·ä½“éªŒï¼Œä½¿å…¶åœ¨è§†è§‰ä¸Šæ›´åŠ å¸å¼•äººã€‚

#### 11.5 code\ultralytics\__init__.py

ä»¥ä¸‹æ˜¯ä¿ç•™çš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼Œå¹¶æ·»åŠ äº†è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
# å¯¼å…¥æ‰€éœ€çš„åº“å’Œæ¨¡å—
# Ultralytics YOLO ğŸš€, AGPL-3.0 license

# å®šä¹‰å½“å‰ç‰ˆæœ¬
__version__ = "8.1.3"

# ä»ultralyticsåº“ä¸­å¯¼å…¥æ•°æ®æ¢ç´¢å™¨
from ultralytics.data.explorer.explorer import Explorer

# å¯¼å…¥ä¸åŒçš„æ¨¡å‹
from ultralytics.models import RTDETR, SAM, YOLO
from ultralytics.models.fastsam import FastSAM
from ultralytics.models.nas import NAS

# å¯¼å…¥è®¾ç½®å’Œæ£€æŸ¥å·¥å…·
from ultralytics.utils import SETTINGS as settings
from ultralytics.utils.checks import check_yolo as checks

# å¯¼å…¥ä¸‹è½½å·¥å…·
from ultralytics.utils.downloads import download

# å®šä¹‰æ¨¡å—çš„å…¬å¼€æ¥å£
__all__ = "__version__", "YOLO", "NAS", "SAM", "FastSAM", "RTDETR", "checks", "download", "settings", "Explorer"
```

### ä»£ç æ³¨é‡Šè¯´æ˜ï¼š

1. **ç‰ˆæœ¬å®šä¹‰**ï¼š
   - `__version__ = "8.1.3"`ï¼šå®šä¹‰å½“å‰æ¨¡å—çš„ç‰ˆæœ¬å·ï¼Œä¾¿äºç®¡ç†å’Œè¿½è¸ªã€‚

2. **æ¨¡å—å¯¼å…¥**ï¼š
   - `from ultralytics.data.explorer.explorer import Explorer`ï¼šå¯¼å…¥æ•°æ®æ¢ç´¢å™¨ï¼Œç”¨äºæ•°æ®é›†çš„å¯è§†åŒ–å’Œåˆ†æã€‚
   - `from ultralytics.models import RTDETR, SAM, YOLO`ï¼šå¯¼å…¥ä¸åŒçš„ç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼ŒRTDETRã€SAMå’ŒYOLOæ˜¯å¸¸ç”¨çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚
   - `from ultralytics.models.fastsam import FastSAM`ï¼šå¯¼å…¥FastSAMæ¨¡å‹ï¼Œå¯èƒ½æ˜¯SAMæ¨¡å‹çš„å¿«é€Ÿå®ç°ã€‚
   - `from ultralytics.models.nas import NAS`ï¼šå¯¼å…¥NASæ¨¡å‹ï¼Œå¯èƒ½ç”¨äºç¥ç»æ¶æ„æœç´¢ã€‚

3. **å·¥å…·å¯¼å…¥**ï¼š
   - `from ultralytics.utils import SETTINGS as settings`ï¼šå¯¼å…¥è®¾ç½®é…ç½®ï¼Œé€šå¸¸ç”¨äºå…¨å±€å‚æ•°çš„ç®¡ç†ã€‚
   - `from ultralytics.utils.checks import check_yolo as checks`ï¼šå¯¼å…¥YOLOæ¨¡å‹çš„æ£€æŸ¥å·¥å…·ï¼Œç”¨äºéªŒè¯æ¨¡å‹çš„æœ‰æ•ˆæ€§å’Œå…¼å®¹æ€§ã€‚
   - `from ultralytics.utils.downloads import download`ï¼šå¯¼å…¥ä¸‹è½½å·¥å…·ï¼Œç”¨äºä¸‹è½½æ¨¡å‹æˆ–æ•°æ®é›†ã€‚

4. **å…¬å¼€æ¥å£å®šä¹‰**ï¼š
   - `__all__ = ...`ï¼šå®šä¹‰æ¨¡å—çš„å…¬å¼€æ¥å£ï¼ŒæŒ‡å®šå“ªäº›å˜é‡å’Œç±»å¯ä»¥è¢«å¤–éƒ¨è®¿é—®ï¼Œå¢å¼ºæ¨¡å—çš„å°è£…æ€§ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶æ˜¯Ultralytics YOLOåº“çš„åˆå§‹åŒ–æ–‡ä»¶ï¼Œä¸»è¦ç”¨äºå®šä¹‰åº“çš„ç‰ˆæœ¬å’Œå¯¼å…¥ç›¸å…³æ¨¡å—ã€‚é¦–å…ˆï¼Œæ–‡ä»¶å¼€å¤´æ³¨é‡Šéƒ¨åˆ†æåˆ°è¿™æ˜¯Ultralytics YOLOçš„ä»£ç ï¼Œå¹¶å£°æ˜äº†å…¶ä½¿ç”¨çš„AGPL-3.0è®¸å¯è¯ã€‚æ¥ç€ï¼Œå®šä¹‰äº†ä¸€ä¸ªåä¸º`__version__`çš„å˜é‡ï¼Œè¡¨ç¤ºå½“å‰åº“çš„ç‰ˆæœ¬ä¸º"8.1.3"ã€‚

éšåï¼Œæ–‡ä»¶ä»ä¸åŒçš„å­æ¨¡å—ä¸­å¯¼å…¥äº†å¤šä¸ªç±»å’Œå‡½æ•°ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒå¯¼å…¥äº†`Explorer`ç±»ï¼Œè¿™ä¸ªç±»ä½äº`ultralytics.data.explorer.explorer`æ¨¡å—ä¸­ï¼Œå¯èƒ½ç”¨äºæ•°æ®æ¢ç´¢å’Œå¯è§†åŒ–ã€‚æ­¤å¤–ï¼Œè¿˜å¯¼å…¥äº†å‡ ä¸ªæ¨¡å‹ç±»ï¼ŒåŒ…æ‹¬`RTDETR`ã€`SAM`ã€`YOLO`å’Œ`FastSAM`ï¼Œè¿™äº›æ¨¡å‹å¯èƒ½ä¸ç›®æ ‡æ£€æµ‹å’Œå›¾åƒåˆ†å‰²ç­‰ä»»åŠ¡ç›¸å…³ã€‚

æ–‡ä»¶è¿˜å¯¼å…¥äº†`NAS`ç±»ï¼Œè¿™å¯èƒ½ä¸ç¥ç»æ¶æ„æœç´¢ï¼ˆNeural Architecture Searchï¼‰ç›¸å…³ï¼Œå¸®åŠ©ç”¨æˆ·å¯»æ‰¾æœ€ä½³çš„æ¨¡å‹æ¶æ„ã€‚åŒæ—¶ï¼Œå¯¼å…¥äº†`SETTINGS`ä½œä¸º`settings`ï¼Œè¿™å¯èƒ½åŒ…å«ä¸€äº›é…ç½®æˆ–å‚æ•°è®¾ç½®ã€‚`check_yolo`å‡½æ•°è¢«å¯¼å…¥ä¸º`checks`ï¼Œç”¨äºå¯¹YOLOæ¨¡å‹è¿›è¡Œæ£€æŸ¥å’ŒéªŒè¯ã€‚æœ€åï¼Œ`download`å‡½æ•°è¢«å¯¼å…¥ï¼Œå¯èƒ½ç”¨äºä¸‹è½½æ‰€éœ€çš„æ¨¡å‹æˆ–æ•°æ®ã€‚

åœ¨æ–‡ä»¶çš„æœ€åï¼Œä½¿ç”¨`__all__`å®šä¹‰äº†ä¸€ä¸ªå…¬å…±æ¥å£ï¼Œåˆ—å‡ºäº†å¯ä»¥è¢«å¤–éƒ¨è®¿é—®çš„æ¨¡å—å’Œç±»ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬å·ã€å„ä¸ªæ¨¡å‹ç±»ã€æ£€æŸ¥å‡½æ•°ã€ä¸‹è½½å‡½æ•°ã€è®¾ç½®å’Œæ•°æ®æ¢ç´¢å™¨ã€‚è¿™ç§åšæ³•æœ‰åŠ©äºæ§åˆ¶æ¨¡å—çš„å¯¼å‡ºå†…å®¹ï¼Œä½¿å¾—ç”¨æˆ·åœ¨ä½¿ç”¨è¯¥åº“æ—¶æ›´åŠ æ¸…æ™°å’Œæ–¹ä¾¿ã€‚

#### 11.6 train.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
class DetectionTrainer(BaseTrainer):
    """
    DetectionTrainerç±»ï¼Œç»§æ‰¿è‡ªBaseTrainerç±»ï¼Œç”¨äºåŸºäºæ£€æµ‹æ¨¡å‹çš„è®­ç»ƒã€‚
    """

    def build_dataset(self, img_path, mode="train", batch=None):
        """
        æ„å»ºYOLOæ•°æ®é›†ã€‚

        å‚æ•°:
            img_path (str): åŒ…å«å›¾åƒçš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚
            mode (str): æ¨¡å¼ï¼Œ`train`è¡¨ç¤ºè®­ç»ƒæ¨¡å¼ï¼Œ`val`è¡¨ç¤ºéªŒè¯æ¨¡å¼ï¼Œç”¨æˆ·å¯ä»¥ä¸ºæ¯ç§æ¨¡å¼è‡ªå®šä¹‰ä¸åŒçš„æ•°æ®å¢å¼ºã€‚
            batch (int, optional): æ‰¹æ¬¡å¤§å°ï¼Œä»…ç”¨äº`rect`æ¨¡å¼ã€‚é»˜è®¤ä¸ºNoneã€‚
        """
        gs = max(int(de_parallel(self.model).stride.max() if self.model else 0), 32)  # è·å–æ¨¡å‹çš„æœ€å¤§æ­¥å¹…
        return build_yolo_dataset(self.args, img_path, batch, self.data, mode=mode, rect=mode == "val", stride=gs)

    def get_dataloader(self, dataset_path, batch_size=16, rank=0, mode="train"):
        """æ„é€ å¹¶è¿”å›æ•°æ®åŠ è½½å™¨ã€‚"""
        assert mode in ["train", "val"]  # ç¡®ä¿æ¨¡å¼æ˜¯è®­ç»ƒæˆ–éªŒè¯
        with torch_distributed_zero_first(rank):  # åœ¨åˆ†å¸ƒå¼è®­ç»ƒä¸­ï¼Œä»…åˆå§‹åŒ–ä¸€æ¬¡æ•°æ®é›†
            dataset = self.build_dataset(dataset_path, mode, batch_size)  # æ„å»ºæ•°æ®é›†
        shuffle = mode == "train"  # è®­ç»ƒæ¨¡å¼ä¸‹æ‰“ä¹±æ•°æ®
        if getattr(dataset, "rect", False) and shuffle:
            LOGGER.warning("WARNING âš ï¸ 'rect=True'ä¸DataLoaderçš„shuffleä¸å…¼å®¹ï¼Œè®¾ç½®shuffle=False")
            shuffle = False  # å¦‚æœä½¿ç”¨rectæ¨¡å¼ï¼Œåˆ™ä¸æ‰“ä¹±æ•°æ®
        workers = self.args.workers if mode == "train" else self.args.workers * 2  # è®¾ç½®å·¥ä½œçº¿ç¨‹æ•°
        return build_dataloader(dataset, batch_size, workers, shuffle, rank)  # è¿”å›æ•°æ®åŠ è½½å™¨

    def preprocess_batch(self, batch):
        """å¯¹ä¸€æ‰¹å›¾åƒè¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬ç¼©æ”¾å’Œè½¬æ¢ä¸ºæµ®ç‚¹æ•°ã€‚"""
        batch["img"] = batch["img"].to(self.device, non_blocking=True).float() / 255  # å°†å›¾åƒè½¬ç§»åˆ°è®¾å¤‡å¹¶å½’ä¸€åŒ–
        if self.args.multi_scale:  # å¦‚æœå¯ç”¨å¤šå°ºåº¦
            imgs = batch["img"]
            sz = (
                random.randrange(self.args.imgsz * 0.5, self.args.imgsz * 1.5 + self.stride)
                // self.stride
                * self.stride
            )  # éšæœºé€‰æ‹©ä¸€ä¸ªæ–°çš„å°ºå¯¸
            sf = sz / max(imgs.shape[2:])  # è®¡ç®—ç¼©æ”¾å› å­
            if sf != 1:  # å¦‚æœç¼©æ”¾å› å­ä¸ä¸º1
                ns = [
                    math.ceil(x * sf / self.stride) * self.stride for x in imgs.shape[2:]
                ]  # è®¡ç®—æ–°çš„å½¢çŠ¶
                imgs = nn.functional.interpolate(imgs, size=ns, mode="bilinear", align_corners=False)  # è¿›è¡Œæ’å€¼ç¼©æ”¾
            batch["img"] = imgs  # æ›´æ–°æ‰¹æ¬¡ä¸­çš„å›¾åƒ
        return batch

    def set_model_attributes(self):
        """è®¾ç½®æ¨¡å‹çš„å±æ€§ï¼ŒåŒ…æ‹¬ç±»åˆ«æ•°é‡å’Œåç§°ã€‚"""
        self.model.nc = self.data["nc"]  # å°†ç±»åˆ«æ•°é‡é™„åŠ åˆ°æ¨¡å‹
        self.model.names = self.data["names"]  # å°†ç±»åˆ«åç§°é™„åŠ åˆ°æ¨¡å‹
        self.model.args = self.args  # å°†è¶…å‚æ•°é™„åŠ åˆ°æ¨¡å‹

    def get_model(self, cfg=None, weights=None, verbose=True):
        """è¿”å›ä¸€ä¸ªYOLOæ£€æµ‹æ¨¡å‹ã€‚"""
        model = DetectionModel(cfg, nc=self.data["nc"], verbose=verbose and RANK == -1)  # åˆ›å»ºæ£€æµ‹æ¨¡å‹
        if weights:
            model.load(weights)  # åŠ è½½æƒé‡
        return model

    def get_validator(self):
        """è¿”å›ç”¨äºYOLOæ¨¡å‹éªŒè¯çš„DetectionValidatorã€‚"""
        self.loss_names = "box_loss", "cls_loss", "dfl_loss"  # å®šä¹‰æŸå¤±åç§°
        return yolo.detect.DetectionValidator(
            self.test_loader, save_dir=self.save_dir, args=copy(self.args), _callbacks=self.callbacks
        )

    def plot_training_samples(self, batch, ni):
        """ç»˜åˆ¶å¸¦æœ‰æ³¨é‡Šçš„è®­ç»ƒæ ·æœ¬ã€‚"""
        plot_images(
            images=batch["img"],
            batch_idx=batch["batch_idx"],
            cls=batch["cls"].squeeze(-1),
            bboxes=batch["bboxes"],
            paths=batch["im_file"],
            fname=self.save_dir / f"train_batch{ni}.jpg",
            on_plot=self.on_plot,
        )
```

### ä»£ç æ ¸å¿ƒéƒ¨åˆ†è§£é‡Šï¼š
1. **DetectionTrainerç±»**ï¼šè¯¥ç±»ç”¨äºå®ç°YOLOæ¨¡å‹çš„è®­ç»ƒï¼Œç»§æ‰¿è‡ªåŸºç¡€è®­ç»ƒç±»`BaseTrainer`ã€‚
2. **build_datasetæ–¹æ³•**ï¼šæ ¹æ®è¾“å…¥çš„å›¾åƒè·¯å¾„å’Œæ¨¡å¼æ„å»ºYOLOæ•°æ®é›†ï¼Œæ”¯æŒè®­ç»ƒå’ŒéªŒè¯æ¨¡å¼ã€‚
3. **get_dataloaderæ–¹æ³•**ï¼šæ„å»ºæ•°æ®åŠ è½½å™¨ï¼Œæ”¯æŒåˆ†å¸ƒå¼è®­ç»ƒï¼Œç¡®ä¿æ•°æ®åŠ è½½çš„æ•ˆç‡ã€‚
4. **preprocess_batchæ–¹æ³•**ï¼šå¯¹è¾“å…¥çš„å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬å½’ä¸€åŒ–å’Œå¯èƒ½çš„å¤šå°ºåº¦è°ƒæ•´ã€‚
5. **set_model_attributesæ–¹æ³•**ï¼šè®¾ç½®æ¨¡å‹çš„ç±»åˆ«æ•°é‡å’Œåç§°ç­‰å±æ€§ï¼Œä»¥ä¾¿æ¨¡å‹å¯ä»¥æ­£ç¡®å¤„ç†ä¸åŒçš„ç±»åˆ«ã€‚
6. **get_modelæ–¹æ³•**ï¼šè¿”å›ä¸€ä¸ªYOLOæ£€æµ‹æ¨¡å‹ï¼Œå¹¶å¯é€‰æ‹©æ€§åœ°åŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚
7. **get_validatoræ–¹æ³•**ï¼šè¿”å›ä¸€ä¸ªç”¨äºéªŒè¯æ¨¡å‹æ€§èƒ½çš„éªŒè¯å™¨ã€‚
8. **plot_training_samplesæ–¹æ³•**ï¼šç»˜åˆ¶è®­ç»ƒæ ·æœ¬åŠå…¶å¯¹åº”çš„æ ‡æ³¨ï¼Œä¾¿äºå¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ `train.py` æ˜¯ä¸€ä¸ªç”¨äºè®­ç»ƒç›®æ ‡æ£€æµ‹æ¨¡å‹çš„è„šæœ¬ï¼Œä¸»è¦åŸºäº YOLOï¼ˆYou Only Look Onceï¼‰æ¶æ„ã€‚å®ƒç»§æ‰¿è‡ª `BaseTrainer` ç±»ï¼Œæä¾›äº†ä¸€ç³»åˆ—ç”¨äºæ„å»ºæ•°æ®é›†ã€åŠ è½½æ•°æ®ã€é¢„å¤„ç†å›¾åƒã€è®¾ç½®æ¨¡å‹å±æ€§ã€è·å–æ¨¡å‹ã€éªŒè¯æ¨¡å‹ã€è®°å½•æŸå¤±ã€ç»˜åˆ¶è®­ç»ƒæ ·æœ¬å’Œç»˜åˆ¶è®­ç»ƒæŒ‡æ ‡çš„åŠŸèƒ½ã€‚

åœ¨æ–‡ä»¶çš„å¼€å¤´ï¼Œå¯¼å…¥äº†ä¸€äº›å¿…è¦çš„åº“å’Œæ¨¡å—ï¼ŒåŒ…æ‹¬æ•°å­¦è¿ç®—ã€éšæœºæ•°ç”Ÿæˆã€æ·±åº¦å­¦ä¹ ç›¸å…³çš„ PyTorch æ¨¡å—ï¼Œä»¥åŠ Ultralytics æä¾›çš„å„ç§å·¥å…·å’ŒåŠŸèƒ½ã€‚è¿™äº›å¯¼å…¥çš„æ¨¡å—ä¸ºåç»­çš„æ¨¡å‹è®­ç»ƒå’Œæ•°æ®å¤„ç†æä¾›äº†æ”¯æŒã€‚

`DetectionTrainer` ç±»ä¸­å®šä¹‰äº†å¤šä¸ªæ–¹æ³•ã€‚`build_dataset` æ–¹æ³•ç”¨äºæ„å»º YOLO æ•°æ®é›†ï¼Œæ¥å—å›¾åƒè·¯å¾„ã€æ¨¡å¼ï¼ˆè®­ç»ƒæˆ–éªŒè¯ï¼‰å’Œæ‰¹é‡å¤§å°ä½œä¸ºå‚æ•°ã€‚å®ƒä½¿ç”¨ `build_yolo_dataset` å‡½æ•°æ¥åˆ›å»ºæ•°æ®é›†ï¼Œå¹¶æ ¹æ®æ¨¡å‹çš„æ­¥å¹…è°ƒæ•´æ•°æ®é›†çš„å¤§å°ã€‚

`get_dataloader` æ–¹æ³•ç”¨äºæ„å»ºå¹¶è¿”å›æ•°æ®åŠ è½½å™¨ã€‚å®ƒæ ¹æ®ä¼ å…¥çš„æ¨¡å¼ï¼ˆè®­ç»ƒæˆ–éªŒè¯ï¼‰æ¥åˆå§‹åŒ–æ•°æ®é›†ï¼Œå¹¶è®¾ç½®æ•°æ®åŠ è½½çš„å‚æ•°ï¼Œæ¯”å¦‚æ˜¯å¦æ‰“ä¹±æ•°æ®å’Œå·¥ä½œçº¿ç¨‹çš„æ•°é‡ã€‚

`preprocess_batch` æ–¹æ³•è´Ÿè´£å¯¹å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬å°†å›¾åƒç¼©æ”¾åˆ°é€‚å½“çš„å¤§å°å¹¶è½¬æ¢ä¸ºæµ®ç‚¹æ•°æ ¼å¼ã€‚å®ƒè¿˜æ”¯æŒå¤šå°ºåº¦è®­ç»ƒï¼Œé€šè¿‡éšæœºé€‰æ‹©å›¾åƒå¤§å°æ¥å¢å¼ºæ¨¡å‹çš„é²æ£’æ€§ã€‚

`set_model_attributes` æ–¹æ³•ç”¨äºè®¾ç½®æ¨¡å‹çš„å±æ€§ï¼ŒåŒ…æ‹¬ç±»åˆ«æ•°é‡å’Œç±»åˆ«åç§°ç­‰ã€‚è¿™äº›å±æ€§ä¼šåœ¨æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­ä½¿ç”¨ã€‚

`get_model` æ–¹æ³•ç”¨äºè¿”å›ä¸€ä¸ª YOLO æ£€æµ‹æ¨¡å‹ï¼Œæ”¯æŒåŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚

`get_validator` æ–¹æ³•è¿”å›ä¸€ä¸ªç”¨äºæ¨¡å‹éªŒè¯çš„ `DetectionValidator` å®ä¾‹ï¼Œè´Ÿè´£åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¯„ä¼°æ¨¡å‹çš„æ€§èƒ½ã€‚

`label_loss_items` æ–¹æ³•ç”¨äºè¿”å›ä¸€ä¸ªåŒ…å«æ ‡è®°è®­ç»ƒæŸå¤±é¡¹çš„å­—å…¸ï¼Œæ–¹ä¾¿åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è®°å½•å’Œåˆ†ææŸå¤±ã€‚

`progress_string` æ–¹æ³•è¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ï¼Œæ˜¾ç¤ºè®­ç»ƒè¿›åº¦ï¼ŒåŒ…æ‹¬å½“å‰çš„è½®æ¬¡ã€GPU å†…å­˜ä½¿ç”¨æƒ…å†µã€æŸå¤±å€¼ã€å®ä¾‹æ•°é‡å’Œå›¾åƒå¤§å°ç­‰ä¿¡æ¯ã€‚

`plot_training_samples` æ–¹æ³•ç”¨äºç»˜åˆ¶è®­ç»ƒæ ·æœ¬åŠå…¶æ ‡æ³¨ï¼Œå¸®åŠ©å¯è§†åŒ–è®­ç»ƒæ•°æ®çš„è´¨é‡ã€‚

æœ€åï¼Œ`plot_metrics` å’Œ `plot_training_labels` æ–¹æ³•åˆ†åˆ«ç”¨äºç»˜åˆ¶è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŒ‡æ ‡å’Œåˆ›å»ºå¸¦æ ‡ç­¾çš„è®­ç»ƒå›¾ï¼Œä¾¿äºåˆ†ææ¨¡å‹çš„è®­ç»ƒæ•ˆæœã€‚

æ€»ä½“è€Œè¨€ï¼Œè¿™ä¸ªæ–‡ä»¶æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„æ¡†æ¶ï¼Œç”¨äºè®­ç»ƒ YOLO ç›®æ ‡æ£€æµ‹æ¨¡å‹ï¼Œæ¶µç›–äº†æ•°æ®å¤„ç†ã€æ¨¡å‹è®­ç»ƒã€éªŒè¯å’Œç»“æœå¯è§†åŒ–ç­‰å¤šä¸ªæ–¹é¢ã€‚

### 12.ç³»ç»Ÿæ•´ä½“ç»“æ„ï¼ˆèŠ‚é€‰ï¼‰

### æ•´ä½“åŠŸèƒ½å’Œæ„æ¶æ¦‚æ‹¬

è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºYOLOï¼ˆYou Only Look Onceï¼‰æ¶æ„çš„ç›®æ ‡æ£€æµ‹å’Œå›¾åƒåˆ†å‰²æ¨¡å‹çš„å®ç°ï¼ŒåŒ…å«å¤šä¸ªæ¨¡å—å’Œå·¥å…·ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªå®Œæ•´çš„è®­ç»ƒã€éªŒè¯å’Œæ¨ç†æ¡†æ¶ã€‚é¡¹ç›®çš„æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬æ•°æ®å¤„ç†ã€æ¨¡å‹è®­ç»ƒã€éªŒè¯ã€å¯è§†åŒ–ä»¥åŠè‡ªå®šä¹‰æ ·å¼è®¾ç½®ã€‚é€šè¿‡ä¸åŒçš„æ¨¡å—ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œæ¨¡å‹çš„è®­ç»ƒå’Œè¯„ä¼°ï¼ŒåŒæ—¶æ”¯æŒå¤šç§æ”¹è¿›å’Œæ‰©å±•ã€‚

é¡¹ç›®çš„æ•´ä½“æ¶æ„å¦‚ä¸‹ï¼š

- **æ¨¡å‹è®­ç»ƒä¸éªŒè¯**ï¼šä¸»è¦é€šè¿‡ `train.py` å’Œ `val.py` æ–‡ä»¶å®ç°ï¼Œè´Ÿè´£æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹å’ŒéªŒè¯è¿‡ç¨‹ã€‚
- **æ•°æ®å¤„ç†ä¸å·¥å…·**ï¼š`atss.py` å’Œ `ops.py` æä¾›äº†æ•°æ®é›†æ„å»ºã€é”šæ¡†ç”Ÿæˆã€IoUè®¡ç®—ç­‰å·¥å…·å‡½æ•°ï¼Œæ”¯æŒæ¨¡å‹çš„è®­ç»ƒå’Œè¯„ä¼°ã€‚
- **ç”¨æˆ·ç•Œé¢**ï¼š`ui.py` å’Œ `ui_style.py` æä¾›äº†ä¸€ä¸ªç®€å•çš„ç”¨æˆ·ç•Œé¢ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡Streamlitè¿›è¡Œäº¤äº’å¼æ“ä½œå’Œå¯è§†åŒ–ã€‚
- **æ¨¡å—åˆå§‹åŒ–**ï¼š`__init__.py` æ–‡ä»¶ç”¨äºå®šä¹‰åº“çš„ç‰ˆæœ¬å’Œå¯¼å…¥ç›¸å…³æ¨¡å—ï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ã€‚
- **æ¨¡å‹æ¨ç†**ï¼š`predict.py` æä¾›äº†æ¨¡å‹æ¨ç†çš„åŠŸèƒ½ï¼Œæ”¯æŒå¯¹æ–°æ•°æ®è¿›è¡Œé¢„æµ‹ã€‚
- **é¢å¤–æ¨¡å—**ï¼šå¦‚ `rep_block.py` å’Œ `checks.py` æä¾›äº†é¢å¤–çš„åŠŸèƒ½å’Œæ£€æŸ¥å·¥å…·ï¼Œå¢å¼ºäº†æ¨¡å‹çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚

### æ–‡ä»¶åŠŸèƒ½æ•´ç†è¡¨

| æ–‡ä»¶è·¯å¾„                                                                                              | åŠŸèƒ½æè¿°                                                         |
|------------------------------------------------------------------------------------------------------|------------------------------------------------------------------|
| `code\ultralytics\models\yolo\segment\val.py`                                                      | å®ç°YOLOåˆ†å‰²æ¨¡å‹çš„éªŒè¯å™¨ï¼Œå¤„ç†æ•°æ®é¢„å¤„ç†ã€æŒ‡æ ‡æ›´æ–°å’Œå¯è§†åŒ–ã€‚   |
| `code\ui.py`                                                                                         | å¯åŠ¨Streamlitåº”ç”¨ï¼Œè¿è¡ŒæŒ‡å®šçš„Webè„šæœ¬ã€‚                          |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\utils\atss.py`                | æä¾›é”šæ¡†ç”Ÿæˆã€IoUè®¡ç®—å’Œè‡ªé€‚åº”è®­ç»ƒæ ·æœ¬é€‰æ‹©ç­‰å·¥å…·å‡½æ•°ã€‚          |
| `code\ui_style.py`                                                                                  | å®šä¹‰Streamlitåº”ç”¨çš„è‡ªå®šä¹‰CSSæ ·å¼ï¼Œæå‡ç”¨æˆ·ç•Œé¢ç¾è§‚æ€§ã€‚         |
| `code\ultralytics\__init__.py`                                                                      | åˆå§‹åŒ–æ–‡ä»¶ï¼Œå®šä¹‰åº“ç‰ˆæœ¬å¹¶å¯¼å…¥ç›¸å…³æ¨¡å—ã€‚                         |
| `train.py`                                                                                           | è´Ÿè´£YOLOæ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ï¼ŒåŒ…æ‹¬æ•°æ®åŠ è½½ã€æ¨¡å‹è®¾ç½®å’ŒæŸå¤±è®°å½•ã€‚     |
| `code\ultralytics\utils\ops.py`                                                                     | æä¾›ä¸æ¨¡å‹æ“ä½œç›¸å…³çš„å·¥å…·å‡½æ•°ï¼Œæ”¯æŒæ¨¡å‹çš„è®­ç»ƒå’Œæ¨ç†ã€‚           |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\sam\build.py`         | æ„å»ºSAMï¼ˆSegment Anything Modelï¼‰æ¨¡å‹çš„ç›¸å…³åŠŸèƒ½ã€‚               |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\utils\checks.py`            | æä¾›æ¨¡å‹æ£€æŸ¥å’ŒéªŒè¯å·¥å…·ï¼Œç¡®ä¿æ¨¡å‹çš„æ­£ç¡®æ€§å’Œæœ‰æ•ˆæ€§ã€‚             |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\nn\extra_modules\ops_dcnv3\modules\__init__.py` | åˆå§‹åŒ–DCNv3æ¨¡å—ï¼Œæ”¯æŒæ·±åº¦å¯åˆ†ç¦»å·ç§¯æ“ä½œã€‚                       |
| `code\ultralytics\utils\checks.py`                                                                  | æä¾›æ¨¡å‹æ£€æŸ¥å’ŒéªŒè¯åŠŸèƒ½ï¼Œç¡®ä¿æ¨¡å‹çš„æ€§èƒ½å’Œæ­£ç¡®æ€§ã€‚               |
| `code\ultralytics\models\yolo\classify\predict.py`                                                 | å®ç°YOLOåˆ†ç±»æ¨¡å‹çš„æ¨ç†åŠŸèƒ½ï¼Œæ”¯æŒå¯¹æ–°æ•°æ®è¿›è¡Œé¢„æµ‹ã€‚             |
| `70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\nn\extra_modules\rep_block.py` | å®šä¹‰é¢å¤–çš„æ¨¡å—ï¼ˆå¦‚æ®‹å·®å—ï¼‰ï¼Œå¢å¼ºæ¨¡å‹çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚       |

è¿™ä¸ªè¡¨æ ¼æ€»ç»“äº†æ¯ä¸ªæ–‡ä»¶çš„ä¸»è¦åŠŸèƒ½ï¼Œå¸®åŠ©ç†è§£é¡¹ç›®çš„æ•´ä½“ç»“æ„å’Œå„ä¸ªæ¨¡å—ä¹‹é—´çš„å…³ç³»ã€‚

æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰â€ä¸­éƒ¨åˆ†ä»£ç å¯èƒ½ä¼šä¼˜åŒ–å‡çº§ï¼Œä»…ä¾›å‚è€ƒå­¦ä¹ ï¼Œå®Œæ•´â€œè®­ç»ƒæºç â€ã€â€œWebå‰ç«¯ç•Œé¢â€å’Œâ€œ70+ç§åˆ›æ–°ç‚¹æºç â€ä»¥â€œ13.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+70+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–â€çš„å†…å®¹ä¸ºå‡†ã€‚

### 13.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+70+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–

![19.png](19.png)


# [ä¸‹è½½é“¾æ¥ï¼šD:\tools\20240905\Temporary](D:\tools\20240905\Temporary)